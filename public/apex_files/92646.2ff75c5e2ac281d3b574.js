"use strict";(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[92646],{851553:(e,t,s)=>{s.d(t,{BusinessDay:()=>i});var n=s(276536),r=s(532448);class i{constructor(e,t,s){this.year=e,this.month=t,this.day=s}toString(){return`${(0,r.addLeadingZeros)(this.year,4)}-${(0,r.addLeadingZero)(this.month)}-${(0,r.addLeadingZero)(this.day)}`}toyyyymmdd(){return`${(0,r.addLeadingZeros)(this.year,4)}${(0,r.addLeadingZero)(this.month)}${(0,r.addLeadingZero)(this.day)}`}compareTo(e){return this.year>e.year||this.year===e.year&&this.month>e.month||this.year===e.year&&this.month===e.month&&this.day>e.day?1:this.year===e.year&&this.month===e.month&&this.day===e.day?0:-1}before(e){return-1===this.compareTo(e)}toCalendar(e){return(0,n.get_cal)(e??(0,n.get_timezone)("Etc/UTC"),this.year,this.month-1,this.day)}addDays(e){const t=this.toCalendar((0,n.get_timezone)("Etc/UTC"));return(0,n.add_date)(t,e),i.fromCalendar(t)}firstDayOfYear(){return new i(this.year,1,1)}getDayOfWeek(){const e=this.toCalendar();return(0,n.get_day_of_week)(e)}static fromCalendar(e){return new i((0,n.get_year)(e),(0,n.get_month)(e)+1,(0,n.get_day_of_month)(e))}}},38447:(e,t,s)=>{s.d(t,{SessionsSpecEntries:()=>h,SessionsSpecEntry:()=>o,SessionsSpecEntryIndex:()=>a,SessionsSpecHistoryEntry:()=>d,compareSessionEntries:()=>i});var n=s(650151),r=s(276536);function i(e,t){return e.compareTo(t)}class o{constructor(e,t,s){(0,n.assert)(Number.isFinite(e)&&Number.isFinite(t)&&Number.isFinite(s),"Invalid arguments"),this._dayOfWeek=e,this._start=t,this._length=s}start(){return this._start+r.minutesPerDay*this.sessionStartDaysOffset()}startOffset(){return this._start}sessionStartDaysOffset(){return this._start>=0?0:this._start%r.minutesPerDay==0?-Math.ceil(this._start/r.minutesPerDay):-Math.floor(this._start/r.minutesPerDay)}isOvernight(){return this._start<0}dayOfWeek(){return this._dayOfWeek}sessionStartDayOfWeek(){let e=this._dayOfWeek-this.sessionStartDaysOffset();return e<r.SUNDAY&&(e+=7),e}length(){return this._length}compareTo(e){const t=this._weight(),s=t+this._length,n=e._weight(),r=n+e._length;return t<=n&&n<s||n<=t&&t<r?0:t>n?1:-1}contains(e){return this._contains((0,r.get_minutes_with_hours)(e),(0,r.get_day_of_week)(e))}_weight(){return this._dayOfWeek*r.minutesPerDay+this._start}_contains(e,t){let s=t-this._dayOfWeek;s>0&&(s-=7);const n=s*r.minutesPerDay+e;return n>=this._start&&n<this._start+this._length}}class a{constructor(e,t,s){this.weekIndex=e,this.entryIndex=t,this.entries=s}getEntry(){return this.entries[this.entryIndex]}}class h{constructor(e,t,s,n){this._maxTradingDayLength=null,this._list=e,this._entriesByDay=t,this._firstDayOfWeek=s,this._weekEndsCount=n}firstDayOfWeek(){return this._firstDayOfWeek}entriesByDay(){return this._entriesByDay}list(){return this._list}isWeekEnd(e){return!this._entriesByDay.has(e)}weekEndsCount(){return this._weekEndsCount}longestSessionLength(){return 0===this._list.length?0:Math.max(...this._list.map((e=>e.length())))}maxTradingDayLength(){if(null==this._maxTradingDayLength){const e=new Map
;for(const t of this._list){const s=t.dayOfWeek();e.set(s,t.length()+(e.get(s)??0))}let t=0;e.forEach((e=>{t=Math.max(t,e)})),this._maxTradingDayLength=t}return this._maxTradingDayLength}}class d{constructor(e,t,s){this._startDay=e,this._entries=s,this._specEndDay=t}getEntries(){return this._entries}getStartDay(){return this._startDay}getSpecEndDay(){return this._specEndDay}isOpenEnded(){return null==this._specEndDay}}},389558:(e,t,s)=>{s.d(t,{SessionsSpecParser:()=>_,workingDaysAndWeekEnds:()=>h});var n=s(650151),r=s(276536),i=s(851553),o=s(38447);const a=[r.MONDAY,r.TUESDAY,r.WEDNESDAY,r.THURSDAY,r.FRIDAY],h=[r.SUNDAY,r.MONDAY,r.TUESDAY,r.WEDNESDAY,r.THURSDAY,r.FRIDAY,r.SATURDAY];function d(e){return e>=48&&e<=57}const c=[0,31,28,31,30,31,30,31,31,30,31,30,31];class l extends Map{constructor(){super(...arguments),this._keyStringsToKey=new Map}get(e){const t=this._keyStringsToKey.get(e.toString());return t&&super.get(t)}set(e,t){const s=e.toString(),n=this._keyStringsToKey.get(s);return void 0!==n&&super.delete(n),this._keyStringsToKey.set(s,e),super.set(e,t)}has(e){return this._keyStringsToKey.has(e.toString())}}function y(e){return e.length>0}class _{constructor(){this.historyEntries=[],this.timezone="",this.adjustSessionsIndexes=null}parseSessions(e,t){this._parseHistoryEntries(e,t,!1)}parseSessionsAndValidateDateTime(e,t){this._parseHistoryEntries(e,t,!0)}static parseHolidaysAndCorrections(e,t,s,n){return this._parseHolidaysAndCorrectionsImpl(e,t,s,n)}static parseHolidaysAndCorrectionsAndValidateDateTime(e,t,s){return this._parseHolidaysAndCorrectionsImpl(e,t,s,!0)}_clearAll(){this.timezone="",this.historyEntries=[],this.adjustSessionsIndexes=[]}_parseHistoryEntries(e,t,s){this._clearAll();const n=t.split("/");let r=null,i=null;this.hasHistoryCorrections=n.length>1;for(let t=0;t<n.length;t++){const a=n[t].split("#");let h=null;if(t!==n.length-1){if(2!==a.length)throw new Error(`bad session history entry definition: ${n[t]}`);h=_._parseDay(a[1],"session history entry end",s).toCalendar()}else{if(1!==a.length)throw new Error(`bad session history entry definition: ${n[t]}`);h=null}if(null!==i&&null!==h&&h.getTime()<i.getTime())throw new Error(`history sessions are not listed in ascending order (${i} -> ${h}`);const d=this._parseSessionsImpl(e,a[0],s);r=this._adjustStartToPreviousSession(d.firstDayOfWeek());const c=new o.SessionsSpecHistoryEntry(r,h,d);this.historyEntries.push(c),i=h}}_parseSessionsImpl(e,t,s){this.timezone=e,t=this._parseFirstDayOfWeek(t);const n=new Map,r=[];if("24x7"===t.toLowerCase())for(const e of h){const t=_._createSessionEntry(e,0,0,0,0);r.push(t);const s=[];s.push(t),n.set(e,s)}else{let e=!1;const i=new Map;for(const s of t.split("|")){const t=s.split(":").filter(y);if(1!==t.length&&2!==t.length)throw new Error(`bad session section: ${s}`);const n=1===t.length;if(n){if(e)throw new Error(`duplicated default section: ${s}`);e=!0}const r=n?a:_._parseWorkingDays(t[1]);for(const e of r)n&&i.has(e)||i.set(e,t[0])}for(const e of h){const t=i.get(e)
;if(void 0!==t)for(const i of t.split(",").filter(y)){const t=_._parseSessionEntry(e,i,s);let o=n.get(e);void 0===o&&(o=[]),o.push(t),r.push(t),n.set(e,o)}}}r.sort(o.compareSessionEntries);const i=new Set;for(const e of r)i.add(e.dayOfWeek());const d=7-i.size;return new o.SessionsSpecEntries(r,n,this._firstDayOfWeek,d)}_parseFirstDayOfWeek(e){const t=e.split(";");if(this._firstDayOfWeek=r.MONDAY,t.length>2)throw new Error(`bad sessions spec: ${e}`);if(1===t.length)return e;let s=1;let n=t[0].indexOf("-")>=0?NaN:parseInt(t[0]);if(isNaN(n)&&(s=0,n=parseInt(t[1])),n<r.SUNDAY||n>r.SATURDAY)throw new Error(`bad sessions spec: ${e}`);return this._firstDayOfWeek=n,t[s]}_adjustStartToPreviousSession(e){if(0===this.historyEntries.length)return null;const t=(0,n.ensureNotNull)(this.historyEntries[this.historyEntries.length-1].getSpecEndDay()),s=e-(0,r.get_day_of_week)(t);if(0===s)return t;const i=(0,r.clone)(t);return(0,r.add_date)(i,s),t.getTime()<i.getTime()||(0,r.add_date)(i,7),i}static _parseSessionEntry(e,t,s){const n=t.split("-");if(2!==n.length)throw new Error(`bad session entry: ${t}`);let r=0,i=n[0];if(i.includes("F")){const e=i.split("F");i=e[0],r=""!==e[1]?parseInt(e[1]):1}let o=0,a=n[1];if(a.includes("F")){const e=a.split("F");a=e[0],o=""!==e[1]?parseInt(e[1]):1}const h=this._minutesFromHHMM(i,t,s),d=this._minutesFromHHMM(a,t,s);return this._createSessionEntry(e,h,d,r,o)}static _minutesFromHHMM(e,t,s){if(4===e.length&&d(e.charCodeAt(0))&&d(e.charCodeAt(1))&&d(e.charCodeAt(2))&&d(e.charCodeAt(3))){const t=parseInt(e),n=Math.trunc(t/100),r=t%100;if(!s||n<24&&r<60)return r+60*n}throw new Error(`incorrect entry syntax: ${t}`)}static _parseDay(e,t,s){if(8===e.length&&d(e.charCodeAt(0))&&d(e.charCodeAt(1))&&d(e.charCodeAt(2))&&d(e.charCodeAt(3))&&d(e.charCodeAt(4))&&d(e.charCodeAt(5))&&d(e.charCodeAt(6))&&d(e.charCodeAt(7))){const t=parseInt(e.substring(0,4)),n=parseInt(e.substring(4,6)),r=parseInt(e.substring(6,8));if(!s||this._isValidDayOfMonth(r,n,t))return new i.BusinessDay(t,n,r)}throw new Error(`bad ${t} date: ${e}`)}static _isValidDayOfMonth(e,t,s){return!(t<1||t>12)&&(!(e<1||e>c[t])||!(2!==t||29!==e||!(0,r.is_leap_year)(s)))}static _parseWorkingDays(e){const t=[];for(let s=0;s<e.length;s++){const n=e.charCodeAt(s)-48;if(n<1||n>7)throw new Error(`Invalid days specification: ${e}`);t.includes(n)||t.push(n)}return t}static _createSessionEntry(e,t,s,i,a){(0,n.assert)(i>=0&&i<7),(0,n.assert)(a>=0&&a<7),0===s&&(s=r.minutesPerDay),i===a&&s<=t&&(i+=1),(0,n.assert)(i>=a),i>0&&(t-=i*r.minutesPerDay),a>0&&(s-=a*r.minutesPerDay);const h=s-t;return(0,n.assert)(e>=r.SUNDAY&&e<=r.SATURDAY),(0,n.assert)(t<r.minutesPerDay),(0,n.assert)(h>0),new o.SessionsSpecEntry(e,t,h)}static _parseHolidaysAndCorrectionsImpl(e,t,s,n){const i=new l;if(""!==t){const e=[];for(const s of t.split(",")){const t=this._parseDay(s,"holiday",n);i.set(t,e)}}if(""===s)return i;for(const e of s.split(";")){const t=e.split(":");if(2!==t.length)throw new Error(`bad correction section: ${e}`);const s=[]
;if("dayoff"!==t[0])for(const e of t[0].split(","))s.push(this._parseSessionEntry(1,e,n));for(const e of t[1].split(",")){const t=this._parseDay(e,"correction",n),a=(0,r.get_day_of_week)(t.toCalendar()),h=[];for(let e=0;e<s.length;e++){const t=s[e];h.push(new o.SessionsSpecEntry(a,t.startOffset(),t.length()))}i.set(t,h)}}return i}}},792646:(e,t,s)=>{s.d(t,{SessionsSpec:()=>y});var n=s(650151),r=s(276536),i=s(127707),o=s(851553),a=s(38447),h=s(389558);function d(e,t){return e.compareTo(t)<0}const c=(0,r.get_timezone)("Etc/UTC");class l{constructor(e){this._value=e}get(){return this._value}set(e){this._value=e}}class y{constructor(e="Etc/UTC",t="0000-0000",s="",n="",i=!1){const o=new h.SessionsSpecParser;i?o.parseSessionsAndValidateDateTime(e,t):o.parseSessions(e,t),this._entries=o.historyEntries,this._hasHistoryCorrections=o.hasHistoryCorrections,this._presentHistoryEntry=o.historyEntries[o.historyEntries.length-1],this._timezone=o.timezone,this._timezoneObj=(0,r.get_timezone)(o.timezone),this._holidayAndCorrectionMap=i?h.SessionsSpecParser.parseHolidaysAndCorrectionsAndValidateDateTime(e,s,n):h.SessionsSpecParser.parseHolidaysAndCorrections(e,s,n,i);const a=this._holidayAndCorrectionMap.keys();this._entriesHash=new Map;const d=this._prepareSessionsBorderParams();this._borderWeeksIndicesHash=d.borderWeeksIndicesHash,this._yearToWeeksIndicesHash=d.yearToWeeksIndicesHash,this._weekIndicesOfLastHistoryWeek=d.weekIndicesOfLastHistoryWeek,this._presentStartWeekIndex=d.startPresentSessionWeekIndex,this._yearToCalculatedAddedWeekIndicesHash=new Map,""===s&&""===n&&null===this._weekIndicesOfLastHistoryWeek?this._isThereCorrections=!1:this._isThereCorrections=!0;for(const e of a){const t=this.getWeekIndex(e.toCalendar());this._entriesHash.set(t,new l(null))}}hasHistoryCorrections(){return this._hasHistoryCorrections}firstDayOfWeek(){return this._presentHistoryEntry.getEntries().firstDayOfWeek()}includesDay(e){return this._getEntriesForDay(e).length>0}getEntriesForWeek(e){if(!this._isThereCorrections)return this._presentHistoryEntry.getEntries();(0,n.assert)(e>=0);const t=e,s=this._entriesHash.get(t);if(void 0===s){return this._getHistoryAndIndexForWeek(t).getEntries()}let i=s.get();if(null!==i)return i;let d=null;const c=this._borderWeeksIndicesHash.get(t);d=void 0===c?this._getHistoryAndIndexForWeek(t).getEntries():this._prepareBorderWeekHistory(c);const l=new Map(d.entriesByDay());let y=[...d.list()];const _=this._weekIndexToLocalDateTime(e),f=this._weekIndexToLocalDateTime(e+1),u=o.BusinessDay.fromCalendar(_),g=o.BusinessDay.fromCalendar(f);for(const[e,t]of this._selectHolidays(u,g)){const s=(0,r.get_day_of_week)(e.toCalendar());y=y.filter((e=>e.dayOfWeek()!==s)),y.push(...t),0===t.length?l.delete(s):l.set(s,t)}y.sort(a.compareSessionEntries);const k=h.workingDaysAndWeekEnds.length-l.size;return i=new a.SessionsSpecEntries(y,l,d.firstDayOfWeek(),k),s.set(i),i}getHistoryByIndex(e){return this._entries[e]}timezone(){return this._timezone}timezoneObj(){return this._timezoneObj}longestSessionLength(){
let e=this._presentHistoryEntry.getEntries().longestSessionLength();for(let t=0;t<this._entries.length-1;t++){const s=this._entries[t].getEntries().longestSessionLength();e=Math.max(e,s)}let t=-1/0;for(const e of this._holidayAndCorrectionMap.values())t=Math.max(t,...e.map((e=>e.length())));return Math.max(t,e)}isWeekEnd(e){const t=this.getWeekIndex(e);let s;return s=void 0===this._borderWeeksIndicesHash.get(t)?this._getHistoryAndIndexForWeek(t).getEntries():this.getEntriesForWeek(t),s.isWeekEnd((0,r.get_day_of_week)(e))}isCalWeekEnd(e){const t=(0,r.get_day_of_week)(e);if(!this._isThereCorrections)return this._presentHistoryEntry.getEntries().isWeekEnd(t);const s=this.getWeekIndex(e),n=this.getEntriesForWeek(s),i=o.BusinessDay.fromCalendar(e),a=this._holidayAndCorrectionMap.get(i);return void 0===a?n.isWeekEnd(t):0===a.length}holidaysFromYearStart(e){const t=e instanceof o.BusinessDay?e:o.BusinessDay.fromCalendar(e);return this._holidaysFromYearStart(t)}daysOffFromYearStart(e){const t=(0,r.get_cal)(c,(0,r.get_year)(e),r.JANUARY,1),s=this.getWeekIndex(t),n=(0,r.get_day_of_week)(t),i=(0,r.get_day_of_week)(e)-1;if((0,r.get_day_of_year)(e)+n<=r.LAST_DAY_OF_WEEK+r.FIRST_DAY_OF_WEEK)return this._getDaysOffForWeekInBorders(s,n,i);const o=this.getWeekIndex(e);let a=this._getDaysOffForWeekInBorders(s,n,r.LAST_DAY_OF_WEEK);for(let e=s+1;e<o;e++){a+=this.getEntriesForWeek(e).weekEndsCount()}return a+=this._getDaysOffForWeekInBorders(o,r.FIRST_DAY_OF_WEEK,i),a}weekEndsCountForSingleSession(){return(0,n.assert)(!this.hasHistoryCorrections()),this._presentHistoryEntry.getEntries().weekEndsCount()}intradayCanBeBuiltFrom24x7(e){for(const t of this._entries)if(!t.getEntries().list().every((t=>t.start()%e==0&&t.length()%e==0)))return!1;return!0}intradayCanBeBuiltFrom24x7Seconds(e){for(const t of this._entries)if(!t.getEntries().list().every((t=>60*t.start()%e==0&&60*t.length()%e==0)))return!1;return!0}indexOfSession(e,t,s){(0,n.assert)(t>=r.SUNDAY&&t<=r.SATURDAY),(0,n.assert)(s>=0&&s<r.minutesPerDay);const o=this.getEntriesForWeek(e),h=o.list();let c=(0,i.lowerbound)(h,new a.SessionsSpecEntry(t,s,0),d);if(c<h.length)return new a.SessionsSpecEntryIndex(e,c,[...h]);let l=e+1,y=this.getEntriesForWeek(l);if(0!==y.list().length){const e=7-t+y.firstDayOfWeek()-1;if(s=-(r.minutesPerDay-s+e*r.minutesPerDay),c=(0,i.lowerbound)(y.list(),new a.SessionsSpecEntry(y.firstDayOfWeek(),s,0),d),c<y.list().length)return new a.SessionsSpecEntryIndex(l,c,[...y.list()])}for(;;)if(l++,s-=r.minutesPerWeek,y=this.getEntriesForWeek(l),0!==y.list().length&&(c=(0,i.lowerbound)(y.list(),new a.SessionsSpecEntry(o.firstDayOfWeek(),s,0),d),!(c>=y.list().length)))return new a.SessionsSpecEntryIndex(l,c,[...y.list()])}findSession(e,t,s,n=0){const r=this.indexOfSession(e,t,s),i=r.entries;let o=r.entryIndex;if(0!==n){const e=i[o].dayOfWeek(),t=n>0?1:-1;for(;;){const s=o+t;if(s<0||s>=i.length||i[s].dayOfWeek()!==e)break;o=s}}return new a.SessionsSpecEntryIndex(r.weekIndex,o,i)}getWeekIndex(e){return this._isThereCorrections?y._getWeekIndexImpl(e):0}correctTradingDay(e){
const t=this._correctTradingDay(this.getWeekIndex(e),(0,r.get_day_of_week)(e),(0,r.get_minutes_with_hours)(e)),s=(0,r.clone)(e);return(0,r.add_date)(s,t),s}alignToSessionStart(e,t=0){const s=(0,r.get_day_of_week)(e),n=(0,r.get_minutes_from_midnight)(e),i=this.getWeekIndex(e),o=this.findSession(i,s,n,t),a=o.getEntry(),h=a.dayOfWeek()-s+7*Math.trunc(o.weekIndex-i);0!==h&&(0,r.add_date)(e,h);const d=a.startOffset();return(0,r.set_hms)(e,Math.trunc(d/60),d%60,0,0),a.length()}businessDaysToCalendarDays(e,t){return this._businessDaysToCalendarDays(this.getWeekIndex(e),(0,r.get_day_of_week)(e),t)}calendarDaysToBusinessDays(e,t){return this._calendarDaysToBusinessDays(this.getWeekIndex(e),(0,r.get_day_of_week)(e),t)}alignToNearestSessionStart(e,t){return this._alignToNearestSessionValue(e,t,this._entrySessionStart.bind(this))}alignToNearestSessionEnd(e,t){return this._alignToNearestSessionValue(e,t,this._entrySessionEnd.bind(this))}bordersOfDailyBar(e){const t=this._getEntriesForDay(e);if(0===t.length)return null;const s=t.slice();s.sort(a.compareSessionEntries);const n=this._getLeftEntryBorder(e,s[0]),i=s[s.length-1],o=60*(i.startOffset()+i.length())-1,h=(0,r.clone)(e);return(0,r.set_seconds)(h,o),{from:n,to:h}}leftBorderOfDailyBar(e){const t=this._getEntriesForDay(e);if(0===t.length)return null;const s=t.slice();return s.sort(a.compareSessionEntries),this._getLeftEntryBorder(e,s[0])}checkSession(){return this._checkEachHistorySession()&&this._checkSpecialEntries()&&this._checkTooManyCorrectionsOnWeek()}inSession(e){e=new Date(1e3*Math.floor(e.getTime()/1e3));const t=this.alignToNearestSessionStart(e,-1),s=this.alignToNearestSessionEnd(t,1);return!(e.getTime()>s.getTime())}hasWeekEnds(){for(const e of this._entries)if(0!==e.getEntries().weekEndsCount())return!0;return!1}getWeekIndicesWithAdditionalWeekBars(e){let t=this._yearToCalculatedAddedWeekIndicesHash.get(e);return void 0===t&&(t=this._calculateAddedIndices(e),this._yearToCalculatedAddedWeekIndicesHash.set(e,t)),t}_prepareSessionsBorderParams(){const e=new Map,t=new Map;let s=null;this._entries.length>1&&(s=Array.from({length:this._entries.length-1},(()=>0)));let r=0;for(let i=0;i<this._entries.length-1;i++){const o=this._entries[i+1],a=(0,n.ensureNotNull)(o.getStartDay());r=y._getWeekIndexImpl(a),e.set(r,i+1),this._addToYearHash(t,a,r),this._entriesHash.set(r,new l(null)),(0,n.ensureNotNull)(s)[i]=r}return{borderWeeksIndicesHash:e,yearToWeeksIndicesHash:t,startPresentSessionWeekIndex:r,weekIndicesOfLastHistoryWeek:s}}_addToYearHash(e,t,s){const n=(0,r.get_year)(t);let i=e.get(n);void 0===i&&(i=[],e.set(n,i)),i.push(s)}_getHistoryAndIndexForWeek(e){if(this._presentStartWeekIndex<=e)return this._presentHistoryEntry;const t=this._getIndexOfHistoryEntry(e);return this._entries[t]}_getIndexOfHistoryEntry(e){let t=0,s=this._entries.length-1,r=Math.floor((t+s)/2);for((0,n.assert)(null!==this._weekIndicesOfLastHistoryWeek);;){if(this._weekIndicesOfLastHistoryWeek[r]>=e){if(s=r-1,s<t)return r}else if(t=r+1,s<t)return r+1;r=Math.floor((t+s)/2)}}_selectHolidays(e,t){
const s=new Set;for(const[n,r]of this._holidayAndCorrectionMap)n.compareTo(e)>=0&&n.compareTo(t)<0&&s.add([n,r]);return s}_prepareBorderWeekHistory(e){const t=this._entries[e-1],s=this._entries[e],i=new Map,o=[],d=(0,r.get_day_of_week)((0,n.ensureNotNull)(s.getStartDay()));for(let e=0;e<h.workingDaysAndWeekEnds.length;e++){const n=h.workingDaysAndWeekEnds[e];if(n<d){const e=t.getEntries().entriesByDay().get(n);void 0!==e&&(o.push(...e),i.set(n,e))}else{const e=s.getEntries().entriesByDay().get(n);void 0!==e&&(o.push(...e),i.set(n,e))}}return new a.SessionsSpecEntries(o,i,s.getEntries().firstDayOfWeek(),0)}_holidaysFromYearStart(e){if(!this._isThereCorrections)return 0;(0,n.assert)(!this.hasHistoryCorrections());const t=e.firstDayOfYear();let s=0;for(const[n,r]of this._selectHolidays(t,e)){const e=n.getDayOfWeek(),t=0===r.length;this._presentHistoryEntry.getEntries().isWeekEnd(e)?s+=t?0:-1:s+=t?1:0}return s}_getDaysOffForWeekInBorders(e,t,s){let n=0;const r=this.getEntriesForWeek(e);for(let e=t;e<=s;e++)r.entriesByDay().has(e)||n++;return n}_weekIndexToLocalDateTime(e){const t=Math.floor(86400*e*7+86400-62167219200),s=(0,r.get_cal_from_unix_timestamp_ms)(c,1e3*t);return(0,r.set_hms)(s,0,0,0,0),s}_correctTradingDay(e,t,s){const n=this.findSession(e,t,s,0);return n.getEntry().dayOfWeek()-t+7*Math.trunc(n.weekIndex-e)}_entrySessionValue(e,t,s,n){t=(0,r.clone)(t);let i=(0,r.get_day_of_week)(t);const o=e.getEntry();let a=o.dayOfWeek()-o.sessionStartDaysOffset();const h=this.getWeekIndex(t);let d=Math.trunc(e.weekIndex-h),c=!1;if(a<r.SUNDAY&&(d<=0?c=!0:d--,a+=7),(d>0&&s>=0||d<0&&s<0)&&(0,r.add_date)(t,7*d),!o.contains(t)){let e=a-i;c&&s<0&&(e=-(7-a+i)),(0,r.add_date)(t,e),i=(0,r.get_day_of_week)(t)}if(o.isOvernight()){const e=o.sessionStartDaysOffset(),s=(i-(o.dayOfWeek()-e)+7)%7;0!==s&&(0,r.add_date)(t,-s)}const l=n(o);return(0,r.set_seconds)(t,l),t}_businessDaysToCalendarDays(e,t,s){let n=0,i=0;for(;i<s;){const o=this.getEntriesForWeek(e);for(let e=t;e<=r.SATURDAY;e++)if(n++,void 0!==o.entriesByDay().get(e)&&i++,i>=s)return n;e++,t=r.SUNDAY}return n}_calendarDaysToBusinessDays(e,t,s){let n=0,i=0;for(;n<s;){const o=this.getEntriesForWeek(e);for(let e=t;e<=r.SATURDAY;e++)if(n++,void 0!==o.entriesByDay().get(e)&&i++,n>=s)return i;e++,t=r.SUNDAY}return i}_entrySessionStart(e,t,s){return this._entrySessionValue(e,t,s,(e=>60*e.start()))}_entrySessionEnd(e,t,s){return this._entrySessionValue(e,t,s,(e=>60*(e.start()+e.length())-1))}_alignToNearestSessionValue(e,t,s){const n=(0,r.get_day_of_week)(e),i=(0,r.get_minutes_with_hours)(e),o=this.getWeekIndex(e);let h=this.findSession(o,n,i);if(1===t)return s(h,e,t);const d=h.getEntry(),c=d.contains(e),l=o===h.weekIndex,y=d.sessionStartDaysOffset()-d.dayOfWeek()>=0;if(c&&(l||y))return s(h,e,t);let _=h.entryIndex-1;if(_<0){let e=h.weekIndex,t=h.entries;if(0===e)e--,_+=t.length;else for(;_<0;)e--,t=this.getEntriesForWeek(e).list(),_+=t.length;h=new a.SessionsSpecEntryIndex(e,_,t)}else h=new a.SessionsSpecEntryIndex(h.weekIndex,_,h.entries);return s(h,e,t)}_getEntriesForDay(e){const t=(0,
r.get_day_of_week)(e),s=this.getEntriesForWeek(this.getWeekIndex(e)).entriesByDay().get(t);return void 0!==s?s:[]}_getLeftEntryBorder(e,t){let s=t.startOffset();const n=-Math.trunc((s-1439)/1440);s+=1440*n;const i=(0,r.get_cal)(c,(0,r.get_year)(e),(0,r.get_month)(e),(0,r.get_day_of_month)(e),Math.trunc(s/60),s%60,0);return(0,r.add_date)(i,-n),i}_checkEachHistorySession(){for(const e of this._entries){const t=e.getEntries().list();if(!this._checkEntriesForIntersections(t,t,t))return!1}return!0}_checkEntriesForIntersections(e,t,s){const n=this._buildTestEntries(e,t,s);for(let e=0;e<n.length-1;e++)for(let t=e+1;t<n.length;t++)if(0===n[e].compareTo(n[t]))return!1;return!0}_buildTestEntries(e,t,s){const n=[];for(let t=0;t<e.length;t++){const s=e[t],r=new a.SessionsSpecEntry(s.dayOfWeek(),s.startOffset(),s.length());n.push(r)}for(let e=0;e<t.length;e++){const s=t[e],r=new a.SessionsSpecEntry(s.dayOfWeek()+7,s.startOffset(),s.length());n.push(r)}for(let e=0;e<s.length;e++){const t=s[e],r=new a.SessionsSpecEntry(t.dayOfWeek()+14,t.startOffset(),t.length());n.push(r)}return n}_checkSpecialEntries(){for(const[e]of this._entriesHash){const t=this.getEntriesForWeek(e).list(),s=this.getEntriesForWeek(e-1).list(),n=this.getEntriesForWeek(e+1).list();if(!this._checkEntriesForIntersections(s,t,n))return!1}return!0}_checkTooManyCorrectionsOnWeek(){if(this._entries.length<2)return!0;for(let e=0;e<this._entries.length-2;e++){const t=this._entries[e],s=this._entries[e+1];if(this.getWeekIndex((0,n.ensureNotNull)(t.getSpecEndDay()))===this.getWeekIndex((0,n.ensureNotNull)(s.getSpecEndDay())))return!1}return!0}_calculateAddedIndices(e){const t=[],s=this._yearToWeeksIndicesHash.get(e);if(void 0===s)return t;for(const e of s){const s=(0,n.ensureDefined)(this._borderWeeksIndicesHash.get(e)),i=this._entries[s],o=this._entries[s-1];let a=i.getEntries().firstDayOfWeek()-o.getEntries().firstDayOfWeek();for(;a>0;){const o=(0,r.clone)((0,n.ensureNotNull)(i.getStartDay()));if((0,r.add_date)(o,-a),!this.isCalWeekEnd(o)){const n={entryIndex:s,weekIndex:e};t.push(n);break}a--}}return t}static _getWeekIndexImpl(e){const t=(0,r.get_cal_utc)((0,r.get_year)(e),(0,r.get_month)(e),1);(0,r.add_date)(t,(0,r.get_day_of_month)(e)-(0,r.get_day_of_week)(e));const s=t.getTime()/1e3;return(0,n.assert)((s+62167219200)%86400==0),Math.trunc((s+62167219200)/86400/7)}}},532448:(e,t,s)=>{function n(e){return r(e,2)}function r(e,t=2){const s=e.toString();return"0".repeat(Math.max(0,t-s.length))+s}s.d(t,{addLeadingZero:()=>n,addLeadingZeros:()=>r})}}]);