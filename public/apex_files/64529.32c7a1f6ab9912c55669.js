(self.webpackChunktradingview=self.webpackChunktradingview||[]).push([[64529],{223124:(e,t,i)=>{"use strict";i.d(t,{isCancelled:()=>o,makeCancelable:()=>n});class r extends Error{constructor(){super("CancelToken")}}function n(e){let t=!1;return{promise:new Promise(((i,n)=>{e.then((e=>t?n(new r):i(e))),e.catch((e=>n(t?new r:e)))})),cancel(){t=!0}}}function o(e){return e instanceof r}},196726:(e,t,i)=>{"use strict";function r(e){e.cancelable&&e.preventDefault()}function n(e){return t=>{r(t),e(t)}}i.d(t,{preventDefault:()=>r,wrapHandlerWithPreventEvent:()=>n})},542682:(e,t,i)=>{"use strict";i.d(t,{isTouchEvent:()=>n});var r=i(778785);function n(e){const t=e.sourceCapabilities;let i=t&&t.firesTouchEvents;return void 0===i&&(i=r.touch),i}},104436:(e,t,i)=>{"use strict";var r;i.d(t,{ToolboxType:()=>r}),function(e){e[e.Delete=0]="Delete"}(r||(r={}))},111495:(e,t,i)=>{"use strict";function r(e){return"economic"===e}i.d(t,{isNonTradableSymbolType:()=>r})},149340:e=>{"use strict";var t=[{d:"E-Mini S&P 500",t:"ES"},{d:"E-Mini Nasdaq 100",t:"NQ"},{d:"Gold",t:"GC"},{d:"Silver",t:"SI"},{d:"Crude Oil WTI",t:"CL"},{d:"Natural Gas",t:"NG"},{d:"Australian Dollar",t:"6A"},{d:"Australian Dollar (Floor)",t:"AD"},{d:"Euro FX",t:"6E"},{d:"Euro FX (Floor)",t:"EC"},{d:"Corn",t:"ZC"},{d:"Corn (Floor)",t:"C"},{d:"Eurodollar",t:"GE"},{d:"Eurodollar (Floor)",t:"ED"}],i=function(){var e=[{pattern:"(",ctor:o},{pattern:")",ctor:s},{pattern:"+",ctor:l},{pattern:"-",ctor:c},{pattern:"*",ctor:u},{pattern:"/",ctor:d},{pattern:"^",ctor:h},{pattern:/\d+(?:\.\d*|(?![a-zA-Z0-9_!:.&]))|\.\d+/,ctor:m},{pattern:/\./,ctor:b},{pattern:/[a-zA-Z0-9_\u0370-\u1FFF_\u2E80-\uFFFF][a-zA-Z0-9_\u0020\u0370-\u1FFF_\u2E80-\uFFFF_!|:.&]*|'.+?'/,ctor:f},{pattern:/'[^']*/,ctor:v},{pattern:/[\0-\x20\s]+/,ctor:n}];function i(e,t){var i=function(){};return i.prototype=t.prototype,e.prototype=new i,e}function r(){}function n(e){this.value=e}function o(){}function s(){}function a(){}function l(){}function c(){}function u(){}function d(){}function h(){}r.prototype.toString=function(){return this.value},i(n,r),i(o,r),o.prototype.value="(",i(s,r),s.prototype.value=")",i(a,r),i(l,a),l.prototype.value="+",l.prototype.precedence=0,l.prototype.commutative=!0,i(c,a),c.prototype.value="-",c.prototype.precedence=0,c.prototype.commutative=!1,i(u,a),u.prototype.value="*",u.prototype.precedence=1,u.prototype.commutative=!0,i(d,a),d.prototype.value="/",d.prototype.precedence=1,d.prototype.commutative=!1,i(h,a),h.prototype.value="^",h.prototype.precedence=2,h.prototype.commutative=!1;var p=/^'?(?:([A-Z0-9_]+):)?(.*?)'?$/i,_=/[+\-/*]/;function f(e){this.value=e}function m(e){this.value=e}function g(e){this.value=e}function v(){f.apply(this,arguments)}function b(){m.apply(this,arguments)}i(f,r),f.prototype.toString=function(){if(this.hasOwnProperty("_ticker")){var e=_.test(this._ticker)?"'":"";return e+(this._exchange?this._exchange+":":"")+this._ticker+e}return this.value},f.prototype.parse=function(){var e=p.exec(this.value);e[1]&&(this._exchange=e[1]),this._ticker=e[2]},
f.prototype.parseAsFutures=function(){this.hasOwnProperty("_ticker")||this.parse();for(var e=function(e){return t.some((function(t){return t.t===e}))},i=2;i>=1;--i){var r=this._ticker.slice(0,i);if(e(r)){this._root=r,this._contract=this._ticker.slice(i);break}}},f.prototype.exchange=function(e){if(this.hasOwnProperty("_ticker")||this.parse(),!(arguments.length>0))return this._exchange;null==e?delete this._exchange:this._exchange=e+""},f.prototype.ticker=function(e){if(this.hasOwnProperty("_ticker")||this.parse(),!(arguments.length>0))return this._ticker;null==e?delete this._ticker:this._ticker=e+"",delete this._root,delete this._contract},f.prototype.root=function(e){if(this.hasOwnProperty("_root")||this.parseAsFutures(),!(arguments.length>0))return this._root;null==e?delete this._root:(this._root=e+"",this._root&&(this._ticker=this._root+(this._contract||"")))},f.prototype.contract=function(e){if(this.hasOwnProperty("_contract")||this.parseAsFutures(),!(arguments.length>0))return this._root;null==e?delete this._contract:(this._contract=e+"",this._root&&(this._ticker=this._root+this._contract))},i(m,r),m.prototype.toString=function(){return this.hasOwnProperty("_normalizedValue")?this._normalizedValue:this.value},m.prototype.parse=function(){this._normalizedValue=this.value.replace(/^0+|\.0*$/g,"").replace(/(\.\d*?)0+$/,"$1").replace(/^(\.|$)/,"0$1")},g.prototype.toString=function(){return this.value},i(v,f),v.prototype.isIncomplete=!0,v.prototype.incompleteSuggest=function(){if("'"!==this.value)return String("'")},i(b,m),b.prototype.isIncomplete=!0;var x=new RegExp(e.map((function(e){return"("+("string"==typeof e.pattern?e.pattern.replace(/[\^$()[\]{}*+?|\\]/g,"\\$&"):e.pattern.source)+")"})).concat(".").join("|"),"g");function y(t,i){var r,o=[];e:for(;r=x.exec(t);){for(var s=e.length;s--;)if(r[s+1]){if(e[s].ctor){var a=new e[s].ctor(r[s+1]);a._offset=r.index,o.push(a)}continue e}var l=new g(r[0]);l._offset=r.index,o.push(l)}if(i&&i.recover){var c;for(s=o.length;s--;){var u=o[s];if(u instanceof m||u instanceof f){if(void 0!==c){var d=new f(""),h=o.splice(s,c-s+1,d);d.value=h.map((function(e){return e.value})).join("")}c=s}else u instanceof n||(c=void 0)}}return o}function w(e){for(var t=[],i=0;i<e.length;i++)e[i]instanceof n||t.push(e[i]);return t}function P(e){e=w(e);for(var t,i=[],r=[],n=0;n<e.length;n++){var l=e[n];if(l instanceof a)r.length&&r[r.length-1].minPrecedence>l.precedence&&(r[r.length-1].minPrecedence=l.precedence);else if(l instanceof o)r.push(t={minPrecedence:1/0,openBraceIndex:n});else if(l instanceof s){var c=e[(t=r.pop()).openBraceIndex-1],u=e[n+1];u instanceof a&&!(u.precedence<=t.minPrecedence)||!(!(c instanceof a)||c.precedence<t.minPrecedence||c.precedence===t.minPrecedence&&c.commutative)||(i.unshift(t.openBraceIndex),i.push(n),r.length&&r[r.length-1].minPrecedence>t.minPrecedence&&(r[r.length-1].minPrecedence=t.minPrecedence))}}for(n=i.length;n--;)e.splice(i[n],1);return e}function S(e){if("string"!=typeof e)throw new TypeError("expression must be a string")
;return(e=y(e)).filter((function(e){return e instanceof f})).map((function(e){return e.exchange()})).filter((function(e){return e}))}function C(e){return 1!==(e=S(e)).length?null:e[0]}function T(e,t){return(e=S(e)).some((function(e){return t.includes((e||"").toUpperCase())}))}function A(e){return e.join("")}return{tokenize:y,validate:function(e){for(var t="init",i="var",r=t,l={warnings:[],errors:[],isEmpty:!0},c=[],u=0;u<e.length;u++){if(!((h=e[u])instanceof n)){if(delete l.isEmpty,h.isIncomplete){var d={status:"incomplete",reason:"incomplete_token",offset:h._offset,token:h};if(h.incompleteSuggest&&(d.recover={append:h.incompleteSuggest()}),l.warnings.push(d),u!==e.length-1){d.status="error";continue}}if(h instanceof f||h instanceof m){if(r===i){l.errors.push({status:"error",reason:"unexpected_token",offset:h._offset,token:h});continue}r=i}else if(h instanceof a){if(r!==i){l.errors.push({status:"error",reason:"unexpected_token",offset:h._offset,token:h});continue}r="operator"}else if(h instanceof o){if(r===i){l.errors.push({status:"error",reason:"unexpected_token",offset:h._offset,token:h});continue}c.push(h),r=t}else if(h instanceof s){if(r!==i){l.errors.push({status:"error",reason:"unexpected_token",offset:h._offset,token:h});continue}c.pop()||l.errors.push({status:"error",reason:"unbalanced_brace",offset:h._offset,token:h,recover:{prepend:new o}}),r=i}else h instanceof g&&l.errors.push({status:"error",reason:"unparsed_entity",offset:h._offset,token:h})}}for(l.braceBalance=c.length,r!==i&&l.warnings.push({status:"incomplete"});c.length;){var h;d={status:"incomplete",reason:"unbalanced_brace",offset:(h=c.pop())._offset,token:h};r===i&&(d.recover={append:new s}),l.warnings.push(d)}return l.currentState=r,0===l.warnings.length&&delete l.warnings,0===l.errors.length&&delete l.errors,l},factorOutBraces:P,normalizeTokens:function(e){for(var t=0;t<e.length;t++)e[t].parse&&e[t].parse();return e},flip:function(e){var t=function(e){for(var t,i=0,r=1,l=2,c=3,u=i,h=0,p=0;p<e.length;p++){var _=e[p];if(!(_ instanceof n))switch(u){case i:if(!(_ instanceof m&&1==+_.value))return!1;u=r;break;case r:if(!(u===r&&_ instanceof d))return!1;u=l,t=p+1;break;case l:if(_ instanceof o)u=c,h=1;else if(_ instanceof a)return!1;break;case c:_ instanceof o?h++:_ instanceof s&&--h<=0&&(u=l)}}return e.slice(t)}(e);return P(t||[new m("1"),new d,new o].concat(e).concat(new s))},hasBatsSymbols:function(e){return T(e,["BATS"])},hasEodSymbols:function(e){return(e=C(e))&&-1!==e.toUpperCase().indexOf("_EOD")},hasChxjpySymbols:function(e){return T(e,["CHXJPY"])},hasFreeDelaySymbols:function(e){return T(e,pro.getProductsByType(pro.PRODUCT_TYPES.exchange).map((function(e){return e.exchange.toUpperCase()+"_DLY"})))},getExchange:C,getExchanges:S,isExchange:function(e,t){return!!(e=C(e))&&e.substring(0,t.length)===t},SymbolToken:f,IncompleteSymbolToken:v,NumberToken:m,BinaryOperatorToken:a,OpenBraceToken:o,CloseBraceToken:s,ticker:function(e){return new f(e).ticker()},shortName:function(e){if("string"!=typeof e)throw new TypeError("expression must be a string")
;var t=P(w(y(e)));return t.forEach((function(e){e instanceof f&&e.exchange(null)})),A(t)},normalize:function(e){if("string"!=typeof e)throw new TypeError("expression must be a string");return A(P(w(y(e))))}}}();e.exports=i},901084:(e,t,i)=>{"use strict";i.d(t,{defaultChartWidgetActionsOptions:()=>r});const r={general:!0,mainSeries:!0,mainSeriesTrade:!1,esdStudies:!0,studies:!0,fundamentals:!0,lineTools:!0,publishedCharts:!0,ordersAndPositions:!0,alerts:!0,chartEvents:!0,objectTree:!0,gotoLineTool:!1}},399870:(e,t,i)=>{"use strict";i.d(t,{clipboardDataForSources:()=>l,isLineToolClipboardData:()=>a});var r=i(650151),n=i(797657),o=i(518006),s=i(703706);function a(e){return"drawing"===e.type}function l(e,t){if(1===t.length&&(0,o.isStudy)(t[0])){const e=t[0];return{title:e.title(n.TitleDisplayTarget.StatusLine),sources:[{source:(0,r.ensureNotNull)(e.state()),type:"study"}]}}const i={sources:[],title:""};return i.sources=t.filter((e=>e.copiable()&&(0,s.isLineTool)(e))).map((t=>{const i={type:"drawing",geometry:t.geometry(),source:{...t.state(!1),points:t.normalizedPoints()},modelId:e};return delete i.source.alertId,i})),i.sources.length>0?(1===i.sources.length?i.title=t[0].title(n.TitleDisplayTarget.StatusLine):i.title="Drawings",i):null}},163288:(e,t,i)=>{"use strict";var r;i.d(t,{TabNames:()=>r}),function(e){e.background="Background",e.coordinates="Coordinates",e.drawings="Drawings",e.events="Events",e.alerts="Alerts",e.inputs="Inputs",e.properties="Properties",e.scales="Scales",e.legend="Legend",e.sourceCode="Source Code",e.style="Style",e.symbol="Symbol",e.timezoneSessions="Timezone/Sessions",e.trading="Trading",e.visibility="Visibility",e.text="Text"}(r||(r={}))},58926:(e,t,i)=>{"use strict";i.d(t,{getPriceAxisNameInfo:()=>s});const r=["Z","Y","X","W","V","U","T","S"],n=["A","B","C","D","E","F","G","H"];class o{constructor(e){this.label=e}equals(e){return null!==e&&this.label===e.label}}function s(e,t){const i="left"===e?r:n,s=t<i.length?i[t]:"";return new o(s)}},904677:(e,t,i)=>{"use strict";i.d(t,{showScriptInfoErrorNoticeDialog:()=>o});var r=i(444372),n=i(779923);function o(){(0,n.showWarning)({title:r.t(null,void 0,i(163200)),text:r.t(null,void 0,i(586698)),buttonText:r.t(null,void 0,i(515462)),backdrop:!0})}},638429:(e,t,i)=>{"use strict";i.d(t,{createTradeContext:()=>n});var r=i(650151);async function n({series:e,isMainChart:t,y:i}){let n=NaN,o=NaN,s="";const a=e.proSymbol(),l=(e.symbolInfo()||{name:null}).name||a,c=e.priceScale();if(i){const t=e.firstValue();n=null!==t?c.coordinateToPrice(i,t):null,s=null!==n?e.formatter().format(n):""}const u=e.bars().last();null!==u&&(o=(0,r.ensure)(u.value[4]));return{symbol:a,displaySymbol:l,value:n,formattedValue:s,last:o,symbolInfoTradable:!!(e.symbolInfo()||{is_tradable:!1}).is_tradable,isMainChart:t}}},514183:(e,t,i)=>{"use strict";i.d(t,{tradingService:()=>o,waitTradingService:()=>s});var r=i(564894);const n={id:"TradingService"};function o(){return(0,r.hasService)(n)?(0,r.service)(n):null}function s(){return(0,r.waitServiceRegistered)(n)}},635505:(e,t,i)=>{
"use strict";i.d(t,{isNewReplaySupportingPlatform:()=>o});var r=i(638456),n=i(314802);function o(){const e=s();return"Desktop App"===e||"Desktop Web"===e||"iPad Web"===e}function s(){if((0,r.isDesktopApp)())return"Desktop App";const e=(0,n.isOnMobileAppPage)("old");return r.CheckMobile.isIPad()?e?"iPad App":"iPad Web":r.CheckMobile.any()?r.CheckMobile.Android()?(0,n.isOnMobileAppPage)("new")?"Android App":"Android Web":r.CheckMobile.iOS()?e?"iPhone App":"iPhone Web":"Unknown Mobile Web":"Desktop Web"}},685411:(e,t,i)=>{"use strict";i.d(t,{ALERT_LABEL_WIDTH:()=>be,AlertLabel:()=>Pe,isAlertLabel:()=>xe});var r=i(650151),n=i(790188),o=i(565487),s=i(728587),a=i(222874),l=i(705826),c=i(751610),u=i(320583),d=i(666310),h=i(104779),p=i(830842),_=i(55846),f=i(77294),m=i(4944),g=i(44322),v=i(123968),b=i(345848),x=i(873720),y=i(610555),w=i(444372),P=i(743099),S=i(578679),C=i(383296),T=i(418092),A=i(672267),M=i(229874),R=i(672423);const k=e=>{if(1!==e.length)return{title:w.t(null,void 0,i(423481)),text:w.t(null,void 0,i(955138)),mainButtonText:w.t(null,void 0,i(14180)),isDangerAction:!0};const t=e[0],r=(0,M.getAlertDescription)(t);return{title:w.t(null,void 0,i(2376)),text:w.t(null,void 0,i(332063)).format({alert:(0,R.cutString)(r,100)}),mainButtonText:w.t(null,void 0,i(14180)),isDangerAction:!0}};var I,B=i(981182),D=i(850699),N=i(753530),E=i(289417);!function(e){e[e.ConnectorOffsetFromPriceScale=37]="ConnectorOffsetFromPriceScale",e[e.ConnectorCircleRadius=4]="ConnectorCircleRadius"}(I||(I={}));class L extends N.BitmapCoordinatesPaneRenderer{constructor(e){super(),this._data=e}hitTest(e,t){const i=(0,E.interactionTolerance)().line;for(let r=0;r<this._data.levels.length;r++){const n=this._data.levels[r],[o,s]=this._calculateLeftRight(this._data,n,t.mediaSize.width,1),a=Math.min(o,s),l=Math.max(o,s);if(Math.abs(n.y-e.y)<=i&&e.x>=a&&e.x<=l)return new S.HitTestResult(S.HitTarget.MovePoint,{activeItem:r,hideCrosshairLinesOnHover:!0,areaName:S.AreaName.Line,cursorType:T.PaneCursorType.VerticalResize})}const r=this._data.levels.map((e=>e.y)),n=Math.min(...r),o=Math.max(...r),s=Math.round(this._data.isLeft?I.ConnectorOffsetFromPriceScale:t.mediaSize.width-I.ConnectorOffsetFromPriceScale);if(Math.abs(s-e.x)<i&&e.y>=n&&e.y<=o){const t=r.reduce(((t,i,r)=>{const n=Math.abs(t.level-e.y);return Math.abs(i-e.y)<n?{index:r,level:i}:t}),{index:0,level:r[0]});return new S.HitTestResult(S.HitTarget.MovePoint,{activeItem:t.index,hideCrosshairLinesOnHover:!0,areaName:S.AreaName.Line,cursorType:T.PaneCursorType.VerticalResize})}return null}_drawImpl(e){const t=e.context;if(t.lineWidth=Math.max(1,Math.floor(e.verticalPixelRatio)),t.strokeStyle=this._data.color,(0,D.setLineStyle)(t,B.LINESTYLE_DASHED),this._data.levels.forEach((i=>{const r=Math.round(i.y*e.verticalPixelRatio),[n,o]=this._calculateLeftRight(this._data,i,e.bitmapSize.width,e.horizontalPixelRatio);(0,D.drawHorizontalLine)(t,r,n,o)})),this._data.withConnector&&this._data.levels.length>1){
const i=Math.round(this._data.isLeft?I.ConnectorOffsetFromPriceScale*e.horizontalPixelRatio:e.bitmapSize.width-I.ConnectorOffsetFromPriceScale*e.horizontalPixelRatio)+.5,r=this._data.levels.map((e=>e.y)),n=Math.min(...r),o=Math.max(...r);t.beginPath(),t.moveTo(i,n*e.verticalPixelRatio),t.lineTo(i,o*e.verticalPixelRatio),t.stroke()}}_calculateLeftRight(e,t,i,r){const n=1===e.levels.length?0:Math.floor(I.ConnectorCircleRadius*r);let o,s;return this._data.isLeft?(s=0,o="full"===t.mode?i:Math.round("toConnector"===t.mode?(I.ConnectorOffsetFromPriceScale-n)*r:this._data.distanceToTooltip*r)):(o="full"===t.mode?0:Math.round("toConnector"===t.mode?i-(I.ConnectorOffsetFromPriceScale-n)*r:i-this._data.distanceToTooltip*r),s=i),[o,s]}}var O=i(906453),V=i(436465),H=i(848511),F=i(147477),z=i(348730),W=i(204181),U=i(615790),Y=i(760223);var Z=i(30556),j=i(674488);const $=" • ",G=(0,H.svgRenderer)(Z),X=(0,H.svgRenderer)(j);class q extends N.BitmapCoordinatesPaneRenderer{constructor(){super(),this._data=null,this._lastPaintTextWidth=null,this._lastPaintPaneWidth=null,this._widthCache=new W.TextWidthCache,this._font=(0,z.makeFont)(12,F.CHART_FONT_FAMILY)}setData(e){this._data=e}hitTest(e){const t=this._data;if(null===this._lastPaintTextWidth||!t||null===this._lastPaintPaneWidth)return null;const i=this._lastPaintTextWidth+16+26,r=this._calculatePoint(t,i,this._lastPaintPaneWidth);{const n=new y.Point(r.x-26+i,r.y-9.5),o=n.add(new y.Point(26,19));if((0,O.pointInBox)(e,(0,y.box)(n,o)))return new S.HitTestResult(S.HitTarget.Custom,{activeItem:t.lineIndex,hideCrosshairLinesOnHover:!0,areaName:S.AreaName.Button,cursorType:T.PaneCursorType.Default,clickHandler:t.buttonAction,tapHandler:t.buttonAction})}{const n=new y.Point(r.x,r.y-9.5),o=n.add(new y.Point(i,19));if((0,O.pointInBox)(e,(0,y.box)(n,o)))return new S.HitTestResult(S.HitTarget.MovePoint,{activeItem:t.lineIndex,hideCrosshairLinesOnHover:!0,areaName:S.AreaName.Tooltip,cursorType:T.PaneCursorType.VerticalResize})}return null}_drawImpl(e){const t=this._data;if(!t)return;const i=e.context;this._lastPaintPaneWidth=e.mediaSize.width,i.font=this._font;const n=t.text,o=t.additionalText;let s=!1,a=null;o&&(this._lastPaintTextWidth=this._widthCache.measureText(i,n+$+o),a=this._tooltipSizes(e),s=a.contentWidth<=a.maxWidth);let l=n;if(!s&&(this._lastPaintTextWidth=this._widthCache.measureText(i,l),a=this._tooltipSizes(e),a.contentWidth>a.maxWidth)){l=function(e,t,i){const r=(0,U.lowerboundExt)((t=>e.substring(0,t)),t,((t,r)=>i(t===e?e:(0,Y.appendEllipsis)(t))<r),0,e.length);return r===e.length?e:(0,Y.appendEllipsis)(e.substring(0,r))}(l,a.maxWidth-16-26,(e=>this._widthCache.measureText(i,e)))}const c=(0,r.ensureNotNull)(a).maxWidth,u=Math.round(c*e.horizontalPixelRatio),d=Math.round(19*e.verticalPixelRatio),h=this._calculatePoint(t,c,this._lastPaintPaneWidth);this._drawBorderAround(t,e,h,u,d,(e=>e.fill())),this._drawButton(t,e,h,u,d),this._drawText(t,e,h,l),s&&this._drawAdditionalText(t,e,h),this._drawBorderAround(t,e,h,u,d,(e=>e.stroke()))}_drawButton(e,t,i,r,n){const o=t.context
;i=i.add(new y.Point(r/t.horizontalPixelRatio,0));{const r=Math.round((i.x-26)*t.horizontalPixelRatio)+.5,s=Math.round(i.y*t.verticalPixelRatio-.5*n)+.5;o.fillStyle=e.buttonBackColor,o.fillRect(r,s,26*t.horizontalPixelRatio,n),o.strokeStyle=e.buttonBorderColor,o.lineWidth=Math.max(1,Math.floor(t.verticalPixelRatio)),o.beginPath(),o.moveTo(r,s),o.lineTo(r,s+n),o.stroke()}0===e.buttonType?this._drawIcon(t,i,G,e.lineColor):1===e.buttonType&&this._drawIcon(t,i,X,e.restartIconColor)}_drawIcon(e,t,i,n){const o=e.context,{width:s,height:a}=i.viewBox();o.fillStyle=(0,r.ensureDefined)(n),i.render(o,{targetViewBox:{x:Math.round((t.x-4-s)*e.horizontalPixelRatio),y:Math.round((t.y-a/2)*e.verticalPixelRatio),width:Math.round(s*e.horizontalPixelRatio),height:Math.round(a*e.verticalPixelRatio)},doNotApplyColors:!0})}_tooltipSizes(e){const t=(0,r.ensureNotNull)(this._lastPaintTextWidth)+16+26,i=Math.max(20,.9*(e.mediaSize.width-80));return{contentWidth:t,maxWidth:Math.min(t,i)}}_drawText(e,t,i,r){const n=t.context,o=Math.round((i.x+8)*t.horizontalPixelRatio),s=Math.round((i.y+5)*t.verticalPixelRatio);n.save(),n.translate(o,s),(0,V.drawScaled)(n,t.horizontalPixelRatio,t.verticalPixelRatio,(()=>{n.fillStyle=e.textColor,n.fillText(r,0,0)})),n.restore()}_drawAdditionalText(e,t,i){const n=t.context,o=Math.round(this._widthCache.measureText(n,e.text)*t.horizontalPixelRatio),s=Math.round(this._widthCache.measureText(n,$)*t.horizontalPixelRatio),a=Math.round((i.x+8)*t.horizontalPixelRatio)+o,l=Math.round((i.y+5)*t.verticalPixelRatio);n.save(),n.fillStyle=(0,r.ensureDefined)(e.additionalTextColor),n.translate(a,l),(0,V.drawScaled)(n,t.horizontalPixelRatio,t.verticalPixelRatio,(()=>{n.fillStyle=(0,r.ensureDefined)(e.textColor),n.fillText($,0,0)})),n.translate(s,0),(0,V.drawScaled)(n,t.horizontalPixelRatio,t.verticalPixelRatio,(()=>{n.fillStyle=(0,r.ensureDefined)(e.additionalTextColor),n.fillText((0,r.ensureDefined)(e.additionalText),0,0)})),n.restore()}_drawBorderAround(e,t,i,r,n,o){const s=t.context,a=Math.round(i.x*t.horizontalPixelRatio)+.5,l=Math.round(i.y*t.verticalPixelRatio-n/2)+.5;s.strokeStyle=e.lineColor,s.lineWidth=Math.max(1,Math.floor(t.verticalPixelRatio));const c=Math.round(4*t.horizontalPixelRatio);s.fillStyle=e.backColor,s.beginPath(),(0,D.drawRoundRect)(s,a,l,r,n,c),o(s)}_calculatePoint(e,t,i){const r=e.point;if(e.center){const n=Math.max(0,.5*(i-t));return e.isLeft?n<r.x?r:new y.Point(n,r.y):n+t<r.x?new y.Point(n,r.y):new y.Point(r.x-t,r.y)}return e.isLeft?r:r.subtract(new y.Point(t,0))}}var J;!function(e){e[e.SelectionPointOffset=37]="SelectionPointOffset",e[e.NoLineModeOffsetSingleLine=47]="NoLineModeOffsetSingleLine",e[e.NoLineModeOffsetMultipleLines=62]="NoLineModeOffsetMultipleLines"}(J||(J={}));const Q=" — ",K=w.t(null,{context:"alert_status"},i(730829)),ee=K+Q+w.t(null,{context:"alert_status"},i(261129)),te=K+Q+w.t(null,{context:"alert_status"},i(401732)),ie=K+Q+w.t(null,{context:"alert_status"},i(660963)),re=new Map([[o.AlertStopReason.Auto,te],[o.AlertStopReason.Manual,ee],[o.AlertStopReason.Expired,ie]])
;function ne(e){return null!==e?re.get(e):void 0}function oe(e,t){switch(e){case o.AlertStopReason.Auto:return t.inActiveTextTriggeredColor;case o.AlertStopReason.Manual:return t.inActiveTextManualColor;case o.AlertStopReason.Expired:return t.inActiveTextExpiredColor;default:return}}class se{constructor(e,t){this._invalidated=!0,this._compositeRenderer=new P.CompositeRenderer,this._tooltipRenderer=new q,this._alertLabel=e,this._model=t}update(){this._invalidated=!0}invalidate(){this._model.lightUpdate()}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._compositeRenderer}_updateImpl(){this._compositeRenderer.clear();const e=this._alertLabel,t=e.alert(),i=t.condition();if(null===i)return;const n=(0,r.ensureNotNull)(this._model.paneForSource(e)),o=(0,r.ensureNotNull)(n.mainDataSource()).firstValue();if(null===o||!e.canDrawLabelForAlert())return;const s=(0,r.ensureNotNull)(e.priceScale()),a=e=>s.priceToCoordinate(e,o),l=[];if("channel"===i.type){const e=a(i.upper),t=a(i.lower);l.push(e),l.push(t)}else l.push(a(i.price));const c=e.isSelected(),u=e.isHovered(),d=this._model.lastHittestData(),h=this._model.lastSelectedHittestData();let p=0;u&&(p=d?.activeItem??0),c&&(p=h?.activeItem??0);const _=this._alertLabel.colors(),f=e.labelLineColor(),m=n.leftPriceScales().includes(s),g=1===l.length?J.NoLineModeOffsetSingleLine:J.NoLineModeOffsetMultipleLines;if(e.drawHorzLine()||c||u){const t=l.map(((t,i)=>({y:t,mode:e.drawHorzLine()?"full":i===p&&1===l.length?"toTooltip":"toConnector"})));this._compositeRenderer.append(new L({distanceToTooltip:g,levels:t,color:f,isLeft:m,withConnector:c||u}))}if(c||u){const e=n.height(),t=l.map((t=>this._model.backgroundColorAtYPercentFromTop(t/e))),i=m?J.SelectionPointOffset:n.width()-J.SelectionPointOffset;this._compositeRenderer.append(new C.SelectionRenderer({points:l.map(((e,t)=>({point:new y.Point(i,e),lineWidth:c&&p===t?1.5:void 0,hitTestResult:new S.HitTestResult(S.HitTarget.MovePoint,{activeItem:t,hideCrosshairLinesOnHover:!0,areaName:S.AreaName.Line,cursorType:T.PaneCursorType.VerticalResize})}))),hittestResult:S.HitTarget.MovePoint,bgColors:t,visible:!0,barSpacing:this._model.timeScale().barSpacing()}))}if((c||u)&&!this._alertLabel.isMoving()){const i=u&&d?.areaName===S.AreaName.Button,r=m?g:n.width()-g,o=t.name()||(e.isMoving()?t.defaultDescription():t.description()),s=this._alertLabel.isInactive()?_.inActiveTextBaseColor:f,a=async()=>{const e=this._alertLabel.alert().id().value(),i=this._alertLabel.alert().isNew().value();e&&!i&&(await(0,A.getAlertsActionCreators)()).deleteAlert(e,{confirmation:k([t]),analytics:{actionLabel:"Alert label source",actionSource:"Chart",event:"restart"}}).execute()},c=async()=>{const e=this._alertLabel.alert().id().value(),t=this._alertLabel.alert().isNew().value();e&&!t&&(await(0,A.getAlertsActionCreators)()).restartAlert(e,{analytics:{actionLabel:"Alert label source",actionSource:"Chart",event:"restart"}}).execute()},h=e.stopReason(),v=null!==h,b={isLeft:m,point:new y.Point(r,l[p]),lineIndex:p,center:e.drawHorzLine(),
text:o,textColor:s,additionalText:ne(h),additionalTextColor:oe(h,_),lineColor:f,backColor:_.connectorBackColor,buttonType:v?1:0,buttonBorderColor:_.tooltipButtonBorderColor,buttonBackColor:i?_.tooltipButtonBorderColorHovered:_.connectorBackColor,buttonAction:v?c:a,restartIconColor:v?_.restartIconColor:void 0,themeName:this._model.dark().value()?"dark":"light"};this._tooltipRenderer.setData(b),this._compositeRenderer.append(this._tooltipRenderer)}}}var ae=i(650369),le=i(207925);class ce{constructor(e){this._renderers=e??[]}clear(){this._renderers=[]}add(e){this._renderers.push(e)}draw(e,t,i,r,n){for(const o of this._renderers)o.draw(e,t,i,r,n)}lastDrawnBodyBox(){let e=null;for(const t of this._renderers)if(t.lastDrawnBodyBox){const i=t.lastDrawnBodyBox();if(null!==i){if(null===e){e=i;continue}e=(0,y.box)((0,y.point)(Math.min(e.min.x,i.min.x),Math.min(e.min.y,i.min.y)),(0,y.point)(Math.max(e.max.x,i.max.x),Math.max(e.max.y,i.max.y)))}}return e}hitTest(e,t,i){let r=null;for(let n=this._renderers.length-1;n>=0;n-=1){const o=this._renderers[n].hitTest?.(e,t,i);null!=o&&(null===r||o.target()>r.target())&&(r=o)}return r}topBottomTotalHeight(e){const t={top:0,bottom:0,total:0};for(const i of this._renderers){const r=i.topBottomTotalHeight(e);t.top=Math.max(t.top,r.top),t.bottom=Math.max(t.bottom,r.bottom),t.top=t.top+t.bottom}return t}setData(e,t){for(const i of this._renderers)i.setData(e,t)}}var ue=i(832126);const de=new Path2D("M6.21 5.27 1.68 1.06A1 1 0 0 0 0 1.79v8.42a1 1 0 0 0 1.68.73l4.53-4.2a1 1 0 0 0 0-1.47Z");class he{constructor(){this._data=null,this._commonData=null,this._bodyBox=null}setData(e,t){this._data=e,this._commonData=t}lastDrawnBodyBox(){return this._bodyBox}draw(e,t,i,r,n){const o=this._data,s=this._commonData;if(!o||!s)return;const a="right"===n,{horizontalPixelRatio:l,verticalPixelRatio:c,bitmapSize:u,mediaSize:d}=t,{borderSize:h}=i,p=a?u.width:Math.max(1,Math.floor(h*l));e.save(),e.fillStyle=o.backgroung??s.background,e.translate(p,Math.round((s.coordinate-6.5+1)*c)),(0,V.drawScaled)(e,a?-l:l,c,(()=>{e.fill(de)})),e.restore();{const e=a?d.width-7:0;this._bodyBox=(0,y.box)((0,y.point)(e,s.coordinate-6.5),(0,y.point)(e+7,s.coordinate+6.5))}}topBottomTotalHeight(e){return{top:0,bottom:0,total:0}}hitTest(e,t,i){return this._data?(0,ue.hittestByData)(this._data,e):null}}var pe;!function(e){e[e.IconMinWidth=23]="IconMinWidth"}(pe||(pe={}));class _e extends le.PriceAxisView{constructor(e,t){super(),this._collapsedAxisRenderer=new he,this._lastDrawnAxisBox=null,this._lastDrawnPaneBox=null,this._alertLabel=e,this._levelIndex=t,this._collapsedAxisRenderer.setData(this._axisRendererData,this._commonRendererData)}renderer(){return this._updateRendererDataIfNeeded(),this._rendererImpl()}ignoreAlignment(){return!0}isOutsideOfVisiblePriceRange(){return this._alertLabel.isOutsideOfVisiblePriceRange()}_updateRendererData(e,t,i){e.visible=!1,t.visible=!1;const r=this._alertLabel.priceScale();if(!r)return;const n=r.mainSource(),o=null!==n?n.firstValue():null;if(r.isEmpty()||null===o)return
;const s=this._alertLabel.priceOfLevel(this._levelIndex);if(null===s)return;const a=this._alertLabel.colors(),l=(0,ae.resetTransparency)(this._alertLabel.labelLineColor());i.background=l,i.textColor=a.iconColor,i.coordinate=r.priceToCoordinate(s,o);const c=this._alertLabel.animation();if(null!==c){const e=c.data(performance.now());i.globalAlpha=e.alpha}else i.globalAlpha=void 0;e.text=r.formatPrice(s,o);const u=this._rendererImpl().lastDrawnBodyBox?.()??this._lastDrawnAxisBox;this._lastDrawnAxisBox=u??this._lastDrawnAxisBox,this._lastDrawnAxisBox&&(e.hitTestData={hoverModelFromAxis:!0,itemBox:this._lastDrawnAxisBox,activeItem:this._levelIndex});const d=this._paneRenderer.lastDrawnBodyBox?.()??this._lastDrawnPaneBox;this._lastDrawnPaneBox=d??this._lastDrawnPaneBox,this._lastDrawnPaneBox&&(t.hitTestData={hoverModelFromAxis:!0,itemBox:this._lastDrawnPaneBox,activeItem:this._levelIndex}),t.hitTarget=S.HitTarget.MovePoint,e.hitTarget=S.HitTarget.Regular,t.labelIcon=1,t.labelIconMinWidth=pe.IconMinWidth,t.visible=!0,e.visible=!0,e.selectedMarkColor=this._alertLabel.isSelected()?l:void 0}_rendererImpl(){return null===this._alertLabel.animation()?this._alertLabel.isHovered()||this._alertLabel.isSelected()?this._axisRenderer:this._collapsedAxisRenderer:new ce([this._collapsedAxisRenderer,this._axisRenderer])}}var fe=i(225627);function me(e,t){return{finished:t=>t-e>=2400,data:i=>{const r=Math.min(i-e,2400)%1200,n=r%600,o=Math.round(r/1200),s=(0,fe.easingFunc.linear)(n/600);return{alpha:0===o==(0===t)?s:1-s}}}}const ge=l.sortSourcesPreOrdered.AlertLabel,ve=l.sortSourcesPreOrdered.AlertLabelInactive,be=5;function xe(e){return e instanceof Pe}const ye={newAlertColor:(0,n.getHexColorByName)("color-cold-gray-450"),inActiveAlertColor:(0,n.getHexColorByName)("color-cold-gray-600"),inActiveTextBaseColor:(0,n.getHexColorByName)("color-cold-gray-450"),inActiveTextManualColor:(0,n.getHexColorByName)("color-cold-gray-450"),inActiveTextTriggeredColor:(0,n.getHexColorByName)("color-tan-orange-500"),inActiveTextExpiredColor:(0,n.getHexColorByName)("color-ripe-red-500"),connectorBackColor:(0,n.getHexColorByName)("color-cold-gray-900"),iconColor:(0,n.getHexColorByName)("color-cold-gray-900"),restartIconColor:(0,n.getHexColorByName)("color-cold-gray-200"),tooltipButtonBorderColor:(0,n.getHexColorByName)("color-cold-gray-800"),tooltipButtonBorderColorHovered:(0,n.getHexColorByName)("color-cold-gray-800")},we={newAlertColor:(0,n.getHexColorByName)("color-cold-gray-450"),inActiveAlertColor:(0,n.getHexColorByName)("color-cold-gray-300"),inActiveTextBaseColor:(0,n.getHexColorByName)("color-cold-gray-550"),inActiveTextManualColor:(0,n.getHexColorByName)("color-cold-gray-550"),inActiveTextTriggeredColor:(0,n.getHexColorByName)("color-tan-orange-500"),inActiveTextExpiredColor:(0,n.getHexColorByName)("color-ripe-red-500"),connectorBackColor:(0,n.getHexColorByName)("color-white"),iconColor:(0,n.getHexColorByName)("color-white"),restartIconColor:(0,n.getHexColorByName)("color-cold-gray-900"),tooltipButtonBorderColor:(0,
n.getHexColorByName)("color-cold-gray-100"),tooltipButtonBorderColorHovered:(0,n.getHexColorByName)("color-cold-gray-100")};class Pe extends a.DataSource{constructor(e,t,i,n){super(),this._priceAxisViews=[],this._paneLabelsPaneViews=[],this._propertyMock=new c.Property,this._startMovingPoint=null,this._currentMovingPoint=null,this._animation=new f.WatchedValue(me(-1/0,0)),this._isOutsideOfVisiblePriceRange=new f.WatchedValue(!0),this._onConditionChanged=()=>{const e=this.alert().condition(),t=e?"channel"===e.type?2:1:0;if(this._priceAxisViews.length!==t){for(let e=this._priceAxisViews.length;e<t;e++){const t=new _e(this,e);this._priceAxisViews.push(t),this._paneLabelsPaneViews.push(new u.PanePriceAxisView(t,this,this._model))}this._priceAxisViews=this._priceAxisViews.slice(0,t),this._paneLabelsPaneViews=this._paneLabelsPaneViews.slice(0,t)}this._priceScale&&this._updatePriceLabelInVisibleRange(this._priceScale.priceRangeInPrice()),this._model.lightUpdate()},this._propertyMock.addProperty("visible",!0),this._model=e,this._alert=t,this._alertOwnerSource=i,this._paneView=new se(this,e),this._invokeAlertEditor=n,this._resetUserEditEnabled(),this._hasAlert.setValue(!0),this._alertSeriesId=(0,r.ensureNotNull)(t.firstConditionSeriesId()),this._alertId=t.id().spawn(),this._alertId.subscribe(this._resetUserEditEnabled.bind(this)),t.onConditionChanged().subscribe(this,this._onConditionChanged),this._onConditionChanged(),this._isBeingEdited=t.isBeingEditedInDialog().spawn(),this._isBeingEdited.subscribe(this._resetUserEditEnabled.bind(this)),this._localFireTime=t.localFireTime().spawn(),this._localFireTime.subscribe(this._onAlertFireTimeChanged.bind(this),{callWithLast:!0}),(0,x.getLabelsSettingsProperty)().subscribe(this,(()=>e.updateSource(this))),this._active=t.active().spawn(),this._active.subscribe((()=>e.updateSource(this))),this._isInactive=(0,m.combine)(((e,t)=>!e&&!t),this._alert.active().weakReference(),this._alert.isNew().weakReference()),this._animationActive=(0,m.combine)(((e,t)=>!e.finished(t)),this._animation.weakReference(),e.drawTime().weakReference()),this._animationActive.subscribe((()=>e.updateSource(this)));const s=(0,m.combine)((e=>[e.symbolInfoWV().weakReference()]),i.symbolSourceWV().weakReference());this._visible=(0,m.combine)(((e,t,i,r,n,s,a)=>!s&&!e&&(t?null!==i&&(i===o.AlertStopReason.Created||a||!n):r)),e.isInReplay().weakReference(),this._isInactive.weakReference(),t.stopReason().weakReference(),(0,_.createWVFromProperty)((0,x.getLabelsSettingsProperty)().childs().visible).ownership(),(0,_.createWVFromProperty)((0,x.getLabelsSettingsProperty)().childs().showOnlyActive).ownership(),(0,m.accumulate)((()=>{const e=this._alertOwnerSource.symbolSource();return e.isConvertedToOtherCurrency()||e.isConvertedToOtherUnit()}),s.ownership()).ownership(),this._animationActive.weakReference()),this._isOutsideOfVisiblePriceRange.subscribe((()=>e.updateSource(this)))}destroy(){this._alertId.destroy(),this._isBeingEdited.destroy(),this._localFireTime.destroy(),this._active.destroy(),this._isInactive.destroy(),
this._animationActive.destroy(),this._visible.destroy(),(0,x.getLabelsSettingsProperty)().unsubscribeAll(this),this._alert.onConditionChanged().unsubscribeAll(this),this._priceScale?.priceRangeChanged().unsubscribeAll(this),super.destroy()}model(){return this._model}zorder(){return this.isInactive()?ve:ge}colors(){return{...this._themedColors(),lineColor:this.labelLineColor()}}alertOwnerSource(){return this._alertOwnerSource}alertSeriesId(){return this._alertSeriesId}alignCrossHairToMovePoint(){return!0}name(){return"AlertLabel"}isSpeciallyZOrderedSource(){return!0}stop(){this._alertId.unsubscribe(this._resetUserEditEnabled),this._isBeingEdited.unsubscribe(this._resetUserEditEnabled)}alert(){return this._alert}isMoving(){return null!==this._startMovingPoint}isHovered(){return this===this._model.hoveredSource()}isSelected(){return this._model.selection().isSelected(this)}alertId(){return this.alert().id().value()}getAlert(){return Promise.resolve(this._alert)}getAlertSync(){return this._alert}priceOfLevel(e){const t=this.alert().condition();return t?"channel"===t.type?[t.upper,t.lower][e]:t.price:null}convertYCoordinateToPriceForMoving(e,t){const i=this.priceScale();if(!t||!i||i.isEmpty())return null;const r=t.firstValue();return null===r?null:i.coordinateToPrice(e,r)}isSynchronizable(){return!1}state(){const e=this.alert().condition(),t=[];return null!==e&&("channel"===e.type?(t.push({price:e.upper}),t.push({price:e.lower})):t.push({price:e.price})),{id:this._id.value(),type:"AlertLabel",zorder:this.zorder(),points:t}}restorePoints(e){}createServerPoints(){}properties(){return this._propertyMock}paneViews(){return window.TradingView.printing||!this._visible.value()?null:[this._paneView]}topPaneViews(){return this._continueAnimationIfNeeded(),!window.TradingView.printing&&this._visible.value()&&this._animationActive.value()?(this.updateAllViews((0,p.sourceChangeEvent)(this.id())),this._paneLabelsPaneViews):null}dataWindowView(){return null}priceAxisViews(e,t){return!window.TradingView.printing&&this._visible.value()&&this.priceScale()===t&&!this._animationActive.value()&&this.canDrawLabelForAlert()?this._priceAxisViews:null}topPriceAxisViews(e,t){return this._continueAnimationIfNeeded(),this._visible.value()&&this.priceScale()===t&&this._animationActive.value()&&this.canDrawLabelForAlert()?(this.updateAllViews((0,p.sourceChangeEvent)(this.id())),this._priceAxisViews):[]}updateAllViews(e){this._paneView.update(),this._priceAxisViews.forEach((t=>t.update(e))),this._paneLabelsPaneViews.forEach((t=>t.update(e)))}pointsCount(){return 0}title(){return this.alert().title()}movable(){return!this._alert.isBeingEditedInDialog().value()&&!this._alert.isNew().value()}startMoving(e,t,i,r){this._userEditEnabled=!1,this._startMovingPoint=e,this.alert().startEditing()}move(e,t,i,n){if(!e.logical||null===t)return;const o=e.logical.price,s=this.alert(),a=(0,r.ensureNotNull)(s.condition());if(this._currentMovingPoint={...e},"channel"===a.type){let{upper:e,lower:i}=a;const n=this._alertOwnerSource.base()||100;0===t?(0,
r.ensureDefined)(this._currentMovingPoint.logical).price=e=Math.max(o,i+1/n):1===t&&((0,r.ensureDefined)(this._currentMovingPoint.logical).price=i=Math.min(o,e-1/n)),s.setCondition({...a,lower:(0,g.roundAlertValueUsingPrecision)(this._alertOwnerSource,i),upper:(0,g.roundAlertValueUsingPrecision)(this._alertOwnerSource,e)})}else s.setCondition({type:"price",price:(0,g.roundAlertValueUsingPrecision)(this._alertOwnerSource,o)});this.updateAllViews((0,p.sourceChangeEvent)(this.id()))}endMoving(){const e=this._startMovingPoint,t=this._currentMovingPoint;if(this._userEditEnabled=!0,this._startMovingPoint=null,this._currentMovingPoint=null,!e||!t||e===t)return;(0,b.trackEvent)("chart_alert","edit","move"),this._invokeAlertEditor({dataSourceHub:this._model,alert:this.alert(),mode:v.AlertEditorInvocationMode.EditAlert,onEditCancel:()=>{setTimeout((async()=>{if(this.isInactive()){const e=this.alert().id().value();void 0!==e&&(await(0,A.getAlertsActionCreators)()).restartAlert(e,{analytics:{actionLabel:"Alert label source",actionSource:"Chart",event:"restart"}}).execute()}else this.alert().abortEditing();this._model.lightUpdate()}),0)},silent:!0,actionSource:"alert_label_move",onAborted:()=>this.alert().abortEditing()})}currentMovingPoint(){return this._currentMovingPoint}showInObjectTree(){return!1}isRemovedByStudyTemplates(){return!1}isUserDeletable(){return!1}doesMovingAffectsUndo(){return!1}drawHorzLine(){return this.labelLineVisible()}canDrawLabelForAlert(){const e=this.alert(),t=this._model.mainSeries(),i=t&&t.properties().childs(),r=i&&i.style&&i.style.value(),n=(0,h.isRangeBasedStyle)(r)?r:null,o=e.crossInterval()||d.Interval.isEqual(e.resolution(),t.interval()),s=e.rangeBasedStyle()===n;return e.isPrice()&&o&&s}labelLineColor(){const e=(0,x.getLabelsSettingsProperty)().childs().line.childs().color.value(),t=e||(0,x.getAlertColorLineByTheme)(this.model());if(this._animationActive.value())return(0,r.ensureDefined)(t);const i=this._themedColors();return this._alert.isNew().value()?(0,r.ensureDefined)(i.newAlertColor):this._alert.active().value()||this._alert.stopReason().value()===o.AlertStopReason.Created?t:(0,r.ensureDefined)(i.inActiveAlertColor)}labelLineVisible(){return(0,x.getLabelsSettingsProperty)().childs().line.childs().visible.value()}showOnlyActive(){return(0,x.getLabelsSettingsProperty)().childs().showOnlyActive.value()}stopReason(){return this.isInactive()?this._alert.stopReason().value():null}animation(){return this._animationActive.value()?this._animation.value():null}isInactive(){return this._isInactive.value()}setPriceScale(e){this._priceScale?.priceRangeChanged().unsubscribeAll(this),e&&(e.priceRangeChanged().subscribe(this,(()=>this._updatePriceLabelInVisibleRange(e.priceRangeInPrice()))),this._updatePriceLabelInVisibleRange(e.priceRangeInPrice())),super.setPriceScale(e)}isOutsideOfVisiblePriceRange(){return this._isOutsideOfVisiblePriceRange.value()}contextMenuStatName(){return"AlertLabelContextMenu"}_updatePriceLabelInVisibleRange(e){this._isOutsideOfVisiblePriceRange.setValue(!!(()=>{
if(null===e)return;const t=this.alert().condition();if(!t)return;const{from:i,to:r}=e;return"channel"===t.type?t.upper<i||t.lower>r:t.price<i||t.price>r})())}_themedColors(){return this._model.dark().value()?ye:we}_resetUserEditEnabled(){const e=this._alert;this._userEditEnabled=!(e.isBeingEditedInDialog().value()||e.isNew().value()||!e.isPrice()||null===e.condition()),(0,b.trackEvent)("chart_alert","edit",`change_user_edit_enabled to ${this._userEditEnabled} for alert ${e.id().value()}`)}_onAlertFireTimeChanged(e){null!==e&&(this._animation.setValue(me(e,this.isHovered()||this.isSelected()?1:0)),this._model.updateSource(this))}_continueAnimationIfNeeded(){this._animationActive.value()&&this._model.invalidate(s.InvalidationMask.cursor())}}},873720:(e,t,i)=>{"use strict";i.d(t,{getAlertColorLineByTheme:()=>R,getAlertSoundsVolume:()=>M,getLabelsSettingsProperty:()=>S,getNotificationsSettingsProperty:()=>T,restoreSettingsProperty:()=>A});var r=i(23482),n=i(650151),o=i(154834),s=i(650279),a=i(998034),l=i(790188),c=i(62802),u=i(61499),d=i(77294),h=i(751610),p=i(55846),_=i(294721);const f="alertLabels",m="alertNotification";let g,v;const b={visible:!0,showOnlyActive:!0,line:{color:"",visible:!0}},x={hideToasts:!0,sound:{volume:.5,isEnabled:!0}},y=new Map([[u.StdTheme.Light,{line:{color:(0,l.getHexColorByName)("color-cold-gray-900")}}],[u.StdTheme.Dark,{line:{color:(0,l.getHexColorByName)("color-cold-gray-200")}}]]);function w(e,t){let i=(0,c.getJSON)(e,null);null===i&&(i=(0,o.default)(t));const r=(0,_.extractAllPropertiesKeys)(t),n=(0,_.extractAllPropertiesKeys)(i);if(!(0,s.default)(r,n)){const e=(0,_.extractState)(i,r);i=(0,a.default)((0,o.default)(t),e)}return i}function P(){g&&(0,c.setJSON)(f,g.state())}function S(){return g||(g=new h.Property(w(f,b)),g.subscribe(null,P),c.onSync.subscribe(null,(()=>{g.mergeAndFire(w(f,b))})),g)}function C(){v&&(0,c.setJSON)(m,v.state())}function T(){return v||(v=new h.Property(w(m,x)),v.subscribe(null,C),c.onSync.subscribe(null,(()=>{v.mergeAndFire(w(m,x))})),v)}function A(){g&&g.mergeAndFire(b),v&&v.mergeAndFire(x)}function M(){if(r.isIOS)return new d.WatchedValue(1).spawn();const e=T().childs().sound.childs(),t=(0,p.combineProperty)(((e,t)=>e?t:0),e.isEnabled.weakReference(),e.volume.weakReference());return(0,p.createWVFromProperty)(t)}function R(e){const t=e.dark().value()?u.StdTheme.Dark:u.StdTheme.Light;return(0,n.ensureDefined)(y.get(t)).line.color}},311872:(e,t,i)=>{"use strict";i.d(t,{BarsMarksContainer:()=>_});var r=i(650151),n=i(735566),o=i(62802),s=i(687037),a=i(666310),l=i(536794),c=i(104779),u=i(222874),d=i(830842);const h=(0,n.getLogger)("Chart.BarsMarksContainer"),p=Math.round(new Date(2037,0,1).getTime()/1e3);class _ extends u.DataSource{constructor(e,t,i){const n=e.onWidget();let a;a=n?!e.hideIdeas():!!s.enabled("bars_marks")&&o.default.getBool("BarsMarksContainer.visibile",!1),t.merge({visible:a}),t.childs().visible.subscribe(null,(t=>{n||e.isSnapshot()||!s.enabled("bars_marks")||o.default.setValue("BarsMarksContainer.visibile",!!t.value())})),super(i),
this._paneViews=[],this._model=e,this._properties=t,this._requests=[],this._marks={},this._loadedRange=null,this._getDataTimeout=null,this._collectedRange=null,this._lastRange=null;const l=this._model.mainSeries();l.onSymbolIntervalChanged().subscribe(this,this.clearMarks),l.dataEvents().symbolResolved().subscribe(this,this.clearMarks),l.dataEvents().completed().subscribe(this,(()=>{const e=l.data();if(0===e.size())return;const t=(0,r.ensureNotNull)(e.first()).index,i=(0,r.ensureNotNull)(e.last()).index,n=this.timeScale();this.getData({start:n.indexToTimePoint(t)??1/0,end:n.indexToTimePoint(i)??-1/0})})),this._initialize(),this._pinnedTooltips={}}destroy(){const e=this._model.mainSeries();e.onSymbolIntervalChanged().unsubscribeAll(this),e.dataEvents().symbolResolved().unsubscribeAll(this),e.dataEvents().completed().unsubscribeAll(this),super.destroy()}model(){return this._model}properties(){return this._properties}marks(){return this._marks}pinTooltip(e,t){this._pinnedTooltips[e]=t}timeScale(){return this._model.timeScale()}getIntervalInTicks(){const e=this._model.mainSeries().properties().childs().interval.value(),t=a.Interval.parse(e);if(!t.isValid())throw new TypeError("Unexpected interval");return t.isRange()?60:t.inMilliseconds()/1e3}getVisibleTickMarksRange(){if(this.timeScale().isEmpty())return{start:0,end:0};const e=(0,r.ensureNotNull)(this.timeScale().visibleBarsStrictRange()),{firstIndex:t,lastIndex:i}=(0,r.ensureNotNull)(this.timeScale().points().range().value());if(!(e.lastBar()>t&&e.firstBar()<i))return{start:0,end:0};let n;n=e.lastBar()<i?this.timeScale().indexToTimePoint(e.lastBar()):p;const o={start:this.timeScale().indexToTimePoint(Math.max(e.firstBar(),t)),end:n};return{start:o.start??1/0,end:o.end??-1/0}}getVisibleRangePlates(){const e=[],t=this.getVisibleTickMarksRange(),i=this.getIntervalInTicks();return Object.keys(this._marks).forEach((r=>{const n=this._marks[r],o=n.tickmark;o>=(t.start??1/0)&&o<=(t.end??-1/0)+i&&e.push(n)})),e}getPublishedPlates(){const e={};return window.is_authenticated?(this.getVisibleRangePlates().forEach((t=>{t.is_public&&(this._pinnedTooltips[t.id]||t.user__id===window.user.id)&&(e[t.id]=t)})),e):e}filterDisplayedPlates(e){const t=e.reduce(((e,t)=>{const i=this._getIndex(t.tickmark);return null!==i&&(e[i]=e[i]||[],e[i].push(t)),e}),{});return Object.keys(t).reduce(((e,i)=>{let r=t[i];return r=r.sort(((e,t)=>t.views_count-e.views_count)),r=r.slice(0,10),e.concat(r)}),[])}getPlatesViewData(){const e=this._model.mainSeries();if(e.data().isEmpty())return[];const t=(0,c.isPriceSourceStyle)(e.style())?e.barFunction():null,i=this.filterDisplayedPlates(this.getVisibleRangePlates()),n={},o=this._model.lastHittestData()??this._model.lastSelectedHittestData();let s=null;null!==o&&this._model.hoveredSource()===this&&(s=o.activeItem??null);const a=[];for(const e of i){const i=(0,r.ensureNotNull)(this._getIndex(e.tickmark)),o=this._getBar(i);if(null===o)continue
;const l=this._layout(e.direction),c=this._theme(e.direction),u=s===e.id,d=this.timeScale().indexToCoordinate(i),h=this._offset(l,o,t),p=(0,r.ensureNotNull)(this.priceScale()).isInverted();let _=0;i in n||(n[i]={up:0,down:0}),_=n[i][l]++,a.push({id:e.id,x:d,y:h,yInverted:p,order:_,direction:l,theme:c,hovered:u,pinned:!0===this._pinnedTooltips[e.id],user__id:e.user__id,label:e.label,labelFontColor:e.labelFontColor||"#444",minSize:e.minSize||5,...this._plateViewData(e)})}const l=a.filter((e=>!0===e.hovered));for(let e=0;e<i.length;e++)i[e].user__id===l[0]?.user__id&&(i[e].highlightByAuthor=!0);return a.sort(((e,t)=>e.hovered&&!t.hovered?1:0)),a}priceAxisViews(){return null}updateAllViews(e){for(const t of this._paneViews)t.update(e)}updateAllViewsAndRepaint(){this.updateAllViews((0,d.sourceChangeEvent)(this.id())),this._model.updateSource(this)}roundRange(e){return{start:Math.round(e.start),end:Math.round(e.end)}}refreshData(){null!==this._lastRange&&this.getData(this._lastRange)}getData(e){(0,l.isNumber)(e.start)&&(0,l.isNumber)(e.end)?(this._lastRange=e,e.end=p,this._pushGetDataStack(Object.assign({},e))):h.logError("Wrong range")}clearMarks(){this._abortAllRequests(),this._marks={},this._loadedRange=null}isUserDeletable(){return!1}isSavedInChart(e){return!1}isSpeciallyZOrderedSource(){return!0}showInObjectTree(){return!1}_plateViewData(e){return{}}_layout(e){switch(e){default:case 0:case 2:case 3:case 4:case 5:case 6:return"up";case 1:return"down"}}_theme(e){switch(e){default:case 0:return"neutral";case 1:case 5:return"green";case 2:case 6:return"red";case 3:return"yellow";case 4:return"blue"}}_offset(e,t,i){let n;switch(e){default:case"up":n=null===i?t[2]:i(t);break;case"down":n=null===i?t[3]:i(t)}return(0,r.ensureNotNull)(this.priceScale()).priceToCoordinate(n,(0,r.ensureNotNull)((0,r.ensureNotNull)(this.ownerSource()).firstValue()))}_getIndex(e){return this.timeScale().timePointToIndex(e)}_getBar(e){return this._model.mainSeries().data().valueAt(e)}_rangeDifference(e){return e=Object.assign({start:1/0,end:-1/0},e),this._loadedRange&&(e.start<this._loadedRange.start?e.end=this._loadedRange.start:e.end>this._loadedRange.end&&(e.start=this._loadedRange.end)),e}_rangeUnion(e,t){return e=Object.assign({start:1/0,end:-1/0},e),t&&(e.start=Math.min(t.start,e.start),e.end=Math.max(t.end,e.end)),e}_pushGetDataStack(e){(0,l.isNumber)(e.start)&&(0,l.isNumber)(e.end)?(this._getDataTimeout&&clearTimeout(this._getDataTimeout),this._collectedRange=this._rangeUnion(e,this._collectedRange),this._getDataTimeout=setTimeout((()=>{this._getData(this._collectedRange),this._getDataTimeout=this._collectedRange=null}),300)):h.logError("Wrong tickmark range")}_abortAllRequests(){this._requests.forEach((e=>{e.cancel()})),this._requests=[],this._getDataTimeout&&clearTimeout(this._getDataTimeout),this._getDataTimeout=this._collectedRange=null}}},338887:(e,t,i)=>{"use strict";i.d(t,{getDataVendorString:()=>n});var r=i(687037);function n(e){
return null==e||r.enabled("bovespa_widget")?null:"QUANDL"===e.exchange?"Quandl.com":["BMFBOVESPA","BME","NAG","TSE","TFX","NZX","BCBA","TWSE","TASE","EURONEXT","TOCOM","BMV","SIX","SGX","GPW","SWB","BCS","WB","SZSE","BELEX","BAHRAIN","EGX","TADAWUL","BVL","LUXSE","DFM","BVC","NSENG","IDX","HSI","QSE","OSE"].includes(e.exchange)?"ICE Data Services":null}},949465:(e,t,i)=>{"use strict";var r;i.d(t,{ChartEventsSourceId:()=>r}),function(e){e.Value="ChartEventsSource"}(r||(r={}))},205432:(e,t,i)=>{"use strict";i.d(t,{fromIndexedTo100:()=>u,fromLog:()=>_,fromPercent:()=>a,getCurrentModePriceText:()=>g,getOppositeModePriceText:()=>v,logFormulaForBase:()=>f,logFormulasAreSame:()=>m,toIndexedTo100:()=>d,toIndexedTo100Range:()=>h,toLog:()=>p,toPercent:()=>l,toPercentRange:()=>c});var r=i(432641),n=i(462140);const o={logicalOffset:4,coordOffset:1e-4},s=305;function a(e,t){return t<0&&(e=-e),e/100*t+t}function l(e,t){const i=100*(e-t)/(t||1);return t<0?-i:i}function c(e,t){const i=l(e.minValue(),t),n=l(e.maxValue(),t);return new r.PriceRange(i,n)}function u(e,t){return t<0&&(e=-e),(e-=100)/100*t+t}function d(e,t){const i=100*(e-t)/t+100;return t<0?-i:i}function h(e,t){const i=d(e.minValue(),t),n=d(e.maxValue(),t);return new r.PriceRange(i,n)}function p(e,t){const i=Math.min(10**s-t.coordOffset,Math.abs(e));if(i<1e-25)return 0;const r=(0,n.log10)(i+t.coordOffset)+t.logicalOffset;return e<0?-r:r}function _(e,t){const i=Math.abs(e);if(i<1e-15)return 0;const r=Math.pow(10,Math.min(i-t.logicalOffset,s))-t.coordOffset;return e<0?-r:r}function f(e){if(null===e)return o;const t=1/e;if(t>=o.coordOffset||t<1e-15)return o;const i=Math.abs(Math.log10(e));return{logicalOffset:i,coordOffset:1/Math.pow(10,i)}}function m(e,t){return e.logicalOffset===t.logicalOffset&&e.coordOffset===t.coordOffset}function g(e,t){return e.isPercentage()?t.formattedPricePercentage:e.isIndexedTo100()?t.formattedPriceIndexedTo100:t.formattedPriceAbsolute}function v(e,t){return e.isPercentage()||e.isIndexedTo100()?t.formattedPriceAbsolute:t.formattedPricePercentage}},296794:(e,t,i)=>{"use strict";var r;i.d(t,{PublishedChartsFilter:()=>r}),function(e){e.None="all",e.Following="following",e.Private="private"}(r||(r={}))},123642:(e,t,i)=>{"use strict";i.d(t,{PublishedChartsTimeline:()=>O});var r=i(444372),n=i(62802),o=i(311872),s=i(481781),a=i(296794),l=i(735566),c=i(345848),u=i(638456),d=i(885148),h=i(954912),p=i(223124),_=i(294721),f=i(650151),m=i(790188),g=i(542682),v=i(906453),b=i(610555),x=i(578679),y=i(436465),w=i(418092);function P(e,t){const{horizontalPixelRatio:i,verticalPixelRatio:r}=t,n=Math.max(1,Math.floor(i)),o=Math.round(e.x*i)+n%2/2;let s=Math.round(e.size*i);(o+s/2)%1!=0&&(s+=1);const a=Math.min(Math.max(1,Math.round(i*e.borderWidth)),s/2);let l;const c=("up"===e.direction?-1:1)*(e.yInverted?-1:1),u=c*(Math.round(e.size*r/2)+n%2);if(void 0!==e.fixedSpaceYPosition){const t=Math.round(e.fixedSpaceYPosition.itemSpacing*r),i=e.fixedSpaceYPosition.order,n=c*(s*i+t*(i+1));l=Math.round(e.fixedSpaceYPosition.basePosition*r)+n+u}else l=Math.round(e.y*r)+u
;return{x:o,y:l,size:s,borderWidth:a,tickSize:n}}function S(e,t,i,r){if(e.save(),i&&!r.highlightByAuthor&&(e.globalAlpha=.4),r.mine)!function(e,t,i){const{borderColor:r,backgroundColor:n,doNotFill:o,direction:s,yInverted:a}=i,{x:l,y:c,borderWidth:u,size:d,tickSize:h}=P(i,t);e.strokeStyle=r,e.fillStyle=n,e.lineWidth=u;const p="up"===s!==a?-1:1;let _=Math.round(d/2/Math.tan(Math.PI/6))+h%2/2;(l+_/2)%1!=0&&(_-=1);e.translate(l,c+_/2*p),e.beginPath();const f=u/2;e.moveTo(0,-p*(_-f)),e.lineTo(d/2-f,u/2),e.lineTo(-d/2+f,u/2),e.lineTo(0,-p*(_-u/2)),e.closePath(),o||e.fill();e.stroke()}(e,t,r);else{0,function(e,t,i,r){const{borderColor:n,backgroundColor:o,label:s}=i,{x:a,y:l,borderWidth:c,size:u}=P(i,t);e.strokeStyle=n,e.fillStyle=o,e.lineWidth=c,e.beginPath();const d=u/2-c/2;e.arc(a,l,d,0,2*Math.PI,!0),e.closePath(),e.fill(),!1;e.stroke(),!r&&s&&u/2>=7&&(e.textAlign="center",e.textBaseline="middle",e.font=s.font,e.fillStyle=s.fontColor,(0,y.drawScaled)(e,t.horizontalPixelRatio,t.verticalPixelRatio,(()=>{e.fillText(s.text,a/t.horizontalPixelRatio,l/t.verticalPixelRatio)})))}(e,t,r,!1,r.image)}e.restore()}class C{constructor(e,t,i,r){this._canvas=null,this._clickHandler=e,this._enterHandler=t,this._leaveHandler=i,this._data=r??null}setData(e){this._data=e}hitTest(e,t){if(null===this._data)return null;for(let i=this._data.items.length-1;i>=0;--i){const r=this._hitTestDot(this._data.items[i],e,t);if(r)return r}return null}draw(e,t){this._canvas=e.canvas,null!==this._data&&this._data.items.forEach(S.bind(null,e,t,this._data.highlightByAuthor))}_hitTestDot(e,t,i){const r=new b.Point(e.x,P(e,i).y/i.verticalPixelRatio);if((0,v.pointInCircle)(t,r,Math.max(e.size/2,8))){const t=this._canvas,i=null===t?void 0:{mouseEnterHandler:()=>this._enterHandler(e,r.y,t),mouseLeaveHandler:()=>this._leaveHandler(),clickHandler:i=>this._clickHandler(e,r.y,t,i),tapHandler:i=>this._clickHandler(e,r.y,t,i)};return new x.HitTestResult(x.HitTarget.Regular,{activeItem:e.originalItem.id,cursorType:w.PaneCursorType.Default,...i})}return null}}var T=i(348730),A=i(147477),M=i(853290);const R={green:{border:(0,m.getHexColorByName)("color-minty-green-700"),background:(0,m.getHexColorByName)("color-minty-green-a600")},red:{border:(0,m.getHexColorByName)("color-ripe-red-700"),background:(0,m.getHexColorByName)("color-ripe-red-500")},neutral:{border:(0,m.getHexColorByName)("color-tan-orange-700"),background:(0,m.getHexColorByName)("color-tan-orange-500")},yellow:{border:"#EAC300",background:"#FFD400"},blue:{border:"#047ACE",background:"#0496FF"}};class k{constructor(e,t){this._tooltip=null,this._hoveredBarsMarkData=null,this._destroyed=!1,this._invalidated=!0,this._originalData=[],this._source=e,this._model=t,this._renderer=new C(this._onItemClicked.bind(this),this._showItem.bind(this),this._hideItem.bind(this)),this._createTooltipRenderer().then((e=>{this._destroyed?e?.destroy():this._tooltip=e})),e.properties().childs().visible.subscribe(null,(()=>{this._tooltip?.hide(!0)}))}destroy(){this._destroyed=!0,this._tooltip?.destroy()}source(){return this._source}
update(){this._invalidated=!0}renderer(){return this._invalidated&&(this._updateImpl(),this._invalidated=!1),this._renderer}onClickOutside(e,t){t&&((0,M.isTouchMouseEvent)(t)?t.isTouch:(0,g.isTouchEvent)(t))&&null!==this._tooltip&&!this._tooltip.contains(t.target)&&this._tooltip.hide(!0)}_extractBarMarksRendererItemData(e,t){const i=t.overridedTheme??R[t.theme],r=this._calculateSize(e,t),n=this._calculateY(e,r,t);return null===this._hoveredBarsMarkData||this._hoveredBarsMarkData.id!==t.id||this._hoveredBarsMarkData.x===t.x&&this._hoveredBarsMarkData.y===Math.round(n)||(this._tooltip?.hide(!0),this._hoveredBarsMarkData=null),{x:t.x,y:this._calculateY(e,r,t),direction:t.direction,borderColor:i.border,borderWidth:I(t),backgroundColor:i.background,size:r,doNotFill:!t.public,yInverted:t.yInverted,label:void 0===t.label?void 0:{text:t.label,fontColor:t.labelFontColor,font:(0,T.makeFont)(Math.ceil(Math.max(10,Math.min(r/2,20))),A.CHART_FONT_FAMILY,"bold")},originalItem:t}}_onItemClicked(e,t,i,r){r.isTouch&&this._showItem(e,t,i)}async _showItem(e,t,i){const r=await this._tooltipProps(e);if(null===r)return;const n=this._model.timeScale().barSpacing(),o=this._calculateSize(n,e.originalItem);this._hoveredBarsMarkData={x:e.x,y:Math.round(this._calculateY(n,o,e.originalItem)),id:e.originalItem.id},this._tooltip?.show({itemSize:o,container:(0,f.ensureNotNull)(i.parentElement),x:e.x,y:t,factoryProps:r,onClickOutside:()=>this._tooltip?.hide(!0)})}_hideItem(){this._tooltip?.hide()}_calculateSize(e,t){return Math.min(553,Math.max(7,t.minSize,.8*e))}_updateImpl(){this._originalData=this._source.getPlatesViewData();const e=this._model.timeScale().barSpacing(),t=this._originalData.map(this._extractBarMarksRendererItemData.bind(this,e));this._renderer.setData({items:t,barSpacing:e,highlightByAuthor:!1})}}function I(e){return e.hovered||e.highlightByAuthor?e.overrideBorderWidth?.hoveredWidth??4:e.overrideBorderWidth?.width??2}const B=(0,l.getLogger)("Chart.PublishedChartsTimeline");class D extends k{constructor(){super(...arguments),this._profileDataCache=new Map}_extractBarMarksRendererItemData(e,t){const i=super._extractBarMarksRendererItemData(e,t);return{...i,fixedSpaceYPosition:{basePosition:t.y,order:t.order,itemSpacing:.2857142857142857*e},mine:t.mine,borderWidth:t.hovered?i.borderWidth:t.public?1:2,doNotFill:!t.public,direction:t.direction}}async _createTooltipRenderer(){const[{TooltipRenderer:e},{PublishedChartsTimelineTooltip:t}]=await Promise.all([Promise.all([i.e(99516),i.e(64670),i.e(35874),i.e(79371),i.e(82321),i.e(70354)]).then(i.bind(i,874149)),Promise.all([i.e(99516),i.e(64670),i.e(35874),i.e(79371),i.e(82321),i.e(70354)]).then(i.bind(i,544252))]);return new e(t)}_calculateY(e,t,i){const r=("up"===i.direction?-1:1)*(i.yInverted?-1:1),n=r*(t*i.order+.2857142857142857*t*(i.order+1));return i.y+t/2*r+n}_onItemClicked(e,t,i,r){super._onItemClicked(e,t,i,r),r.isTouch||this.source().showIdea(e.originalItem.id,!1)}async _tooltipProps(e){const t=(0,f.ensureDefined)(e.originalItem.username);let i=this._profileDataCache.get(t)
;if(void 0===i){try{i=await function(e){return fetch(`/api/v1/user/profile/${e}/?avatars_fallback=true&by=username`).then((e=>e.json()))}(t)}catch(e){return B.logWarn(`An error ocurred while loading profile data: ${e}`),null}this._profileDataCache.set(t,i)}return Promise.resolve({avatarUrl:i.avatars?.mid,badges:i.badges,title:(0,f.ensureDefined)(e.originalItem.title),username:t,onTitleClicked:()=>this.source().showIdea(e.originalItem.id,!1)})}}var N=i(705826),E=i(314802);const L=(0,l.getLogger)("Chart.PublishedChartsTimeLine");class O extends o.BarsMarksContainer{constructor(e,t){let i=n.default.getValue("PublishedChartsTimeline.filter",a.PublishedChartsFilter.None);window.is_authenticated||(i=a.PublishedChartsFilter.None);const r=new _.DefaultProperty({defaultName:"publishedchartstimeline",state:{filter:i}});super(e,r),this.setId("PublishedChartsTimeline"),this._paneView=new D(this,e),this._paneViews=[this._paneView],this._currentRange=null,this._properties.childs().visible.subscribe(this,(()=>{this._getData(this._currentRange)})),r.childs().filter.subscribe(this,(e=>{n.default.setValue("PublishedChartsTimeline.filter",e.value()),this.clearMarks(),this._getData(this._currentRange)})),this._containsData=e.isSnapshot(),this._containsData&&this._properties.childs().visible.setValue(!0),this.setUserEditEnabled(!1),this._onIdeaClickedHandler=t}destroy(){this._onIdeaClickedHandler=null,this._boundOnMessage&&(s.pushStreamMultiplexer.off("ideas",this._boundOnMessage),s.pushStreamMultiplexer.off("ideas.post",this._boundOnMessage),this._boundOnMessage=null),this._paneView.destroy(),super.destroy()}name(){return"Ideas on chart"}title(){return r.t(null,void 0,i(958757))}zorder(){return N.sortSourcesPreOrdered.BarMarks}paneViews(){return this._model.isInReplay().value()||!this._properties.childs().visible.value()?[]:this._paneViews}showIdea(e,t){const i=this._marks[e];i?((0,c.trackEvent)("GUI","View published idea"),t&&(0,c.trackEvent)("GUI","Ideas navigation arrow"),(0,u.onWidget)()||this._containsData||(0,E.isOnMobileAppPage)("any")?window.open(`${this._getBaseUrl()}${i.published_chart_url||"/v/"+i.image_url+"/"}`):i.image_url&&this._onIdeaClickedHandler?.({uid:i.image_url,url:i.published_chart_url})):L.logDebug("PublishedChartsTimeline.showIdea: unexpected published chart id")}state(e){const t={type:"BarsMarksContainer",id:this.id(),zorder:this.zorder(),pinnedTooltips:this._pinnedTooltips};return e&&this._properties.childs().visible.value()&&(t.marks=this.getPublishedPlates()),t}restoreData(e,t){null!=e.pinnedTooltips&&(this._pinnedTooltips=e.pinnedTooltips),t&&void 0!==e.marks&&(this._marks=e.marks)}onClickOutside(e,t){this._paneView.onClickOutside(e,t)}contextMenuStatName(){return"PublishedChartsTimelineContextMenu"}_getIndex(e){return this.timeScale().timePointToIndex(e,1)}_initialize(){s.pushStreamMultiplexer&&(this._boundOnMessage=this._onMessage.bind(this),s.pushStreamMultiplexer.on("ideas",this._boundOnMessage),s.pushStreamMultiplexer.on("ideas.post",this._boundOnMessage))}_plateViewData(e){return{title:e.title,
user_id:e.user__id,username:e.username,suggested:e.is_hot,mine:e.user__id===window.user.id,public:e.is_public}}_getData(e,t){const i=this._model.mainSeries().properties().childs(),r=this._model.mainSeries().symbolInfo();if(this._currentRange=e,!r||!this._properties.childs().visible.value()&&!t)return Promise.resolve([]);let n=r.base_name.length>1?r.base_name:[r.pro_name];const o=this.roundRange(this._rangeDifference(e));n=(0,d.uniq)(n),n=n.sort();const s=new FormData;s.append("interval",i.interval.value()),s.append("legs",JSON.stringify(n)),s.append("startTickmark",o.start.toString()),s.append("endTickmark",o.end.toString()),s.append("filter",this.properties().childs().filter.value());const a=(0,p.makeCancelable)(new Promise(((e,t)=>{(0,h.fetch)("/charttimeline/",{method:"POST",body:s,headers:new Headers({acccept:"application/json","X-Requested-With":"XMLHttpRequest"})}).then((i=>{i.ok?i.json().then(e):t()})).catch(t)})));return a.promise.then((t=>{t.forEach((e=>{this._marks[e.id]=e})),this._loadedRange=this._rangeUnion(e,this._loadedRange);const i=this._requests.indexOf(a);~i&&this._requests.splice(i,1),this.updateAllViewsAndRepaint()})),this._requests.push(a),a.promise}_onMessage(e,t,i,r){if(this._containsData)return;const n=this._model.mainSeries(),o=n.symbolInfo(),s=o&&o.base_name;if(!s)return;const a=n.properties().childs();e.interval===a.interval.value()&&~s.indexOf(e.pro_symbol)&&(this._marks[e.id]=e,this.updateAllViewsAndRepaint())}_getBaseUrl(){if((0,u.onWidget)()&&window.locale_domains){const e=window.locale||"en",t=window.locale_domains[e]?window.locale_domains[e]:window.locale_domains.en;return t?document.location.protocol+"//"+t:""}return""}}},496983:(e,t,i)=>{"use strict";i.d(t,{sourcesAffectState:()=>o});var r=i(453751),n=i(399285);function o(e){return!n.lineToolsDoNotAffectChartInvalidation||e.some((e=>!(0,r.isLineTool)(e)))}},672267:(e,t,i)=>{"use strict";i.d(t,{getAlertsActionCreators:()=>n});var r=i(481251);const n=(0,r.default)((async()=>new((await Promise.all([i.e(20982),i.e(55091),i.e(43287),i.e(58229),i.e(84705),i.e(49502)]).then(i.bind(i,363075))).AlertsActionCreators)));(0,r.default)((async()=>{const[e,{getAlertSession:t}]=await Promise.all([Promise.all([i.e(66396),i.e(84705),i.e(68074)]).then(i.bind(i,702364)),Promise.all([i.e(87178),i.e(55848)]).then(i.bind(i,509163))]);return new e.FiresActionCreators(t())}))},229874:(e,t,i)=>{"use strict";i.d(t,{getAlertDescription:()=>l});var r=i(650151),n=i(129303);var o=i(592487);var s=i(945397);function a({symbol:e,watchlistName:t,resolution:i,crossInterval:n,includeExchange:a}){return t?function(e){const t=e.watchlistName;return e.crossInterval||!e.resolution?t:t+(0,o.formatAppendingResolutionString)(e.resolution)}({watchlistName:t,resolution:i,crossInterval:n}):(0,s.formatSymbolAndResolution)({symbol:(0,r.ensureNotNull)(e),resolution:i,crossInterval:n},a)}function l(e){return function(e){return"function"==typeof e.name?e.name():e.name}(e)||function(e){return"description"in e?e.description():e.message}(e)||function(e){const t=function(e){
return"dataSource"in e?"symbol"===e.dataSource.type?e.dataSource.symbol:null:"function"==typeof e.symbol?(0,n.decodeExtendedSymbol)(e.symbol()):e.symbol}(e),i=function(e){if("dataSource"in e&&"watchlist"===e.dataSource.type)return e.dataSource.watchlistName;return null}(e),{resolution:o,crossInterval:s}=function(e){if(function(e){return"resolution"in e&&"function"==typeof e.resolution}(e))return{resolution:e.resolution(),crossInterval:e.crossInterval()};return function(e){const t=function(e){return e.find((e=>!e.crossInterval))}(e);return t?{resolution:t.resolution,crossInterval:!1}:{resolution:null,crossInterval:!0}}(e.conditions)}(e);return a({symbol:(0,r.ensureNotNull)(t),watchlistName:i,resolution:o,crossInterval:s})}(e)}},588154:(e,t,i)=>{"use strict";i.d(t,{getAlertsChartActionCreators:()=>r});const r=(0,i(481251).default)((async()=>{const{getCreateAlertAction:e}=await Promise.all([i.e(16085),i.e(43853)]).then(i.bind(i,153373)),{getEditAlertOnLineDataSourceAction:t}=await Promise.all([i.e(16085),i.e(43853)]).then(i.bind(i,619931));return{createAlert:e,editAlertOnLineDataSource:t}}))},44322:(e,t,i)=>{"use strict";function r(e,t){const i=e.formatter();if(i.parse){const e=i.parse(i.format(t));if(e.res)return e.value}return t}i.d(t,{roundAlertValueUsingPrecision:()=>r})},592487:(e,t,i)=>{"use strict";i.d(t,{formatAppendingResolutionString:()=>n});var r=i(300459);function n(e){const t=(0,r.getTranslatedResolution)(e);return(0,r.formatDirectionalResolution)(t)}},945397:(e,t,i)=>{"use strict";i.d(t,{formatSymbolAndResolution:()=>a,formatSymbolString:()=>l});var r=i(149340),n=i.n(r),o=i(129303),s=i(592487);function a(e,t){const i=l(e.symbol,t);if(e.crossInterval||!e.resolution)return i;return i+(0,s.formatAppendingResolutionString)(e.resolution)}function l(e,t){let i=(0,o.unwrapSimpleSymbol)(e);return t||(i=n().shortName(i)),i}},672423:(e,t,i)=>{"use strict";function r(e,t){const i=new URL("chart",window.location.origin);if(i.searchParams.append("symbol",e),t){const{resolution:e,chartStyle:r}=t;e&&i.searchParams.append("interval",e),r&&i.searchParams.append("style",r.toString())}return i.toString()}function n(e){const t={...e};for(const e of Object.keys(t))void 0===t[e]&&delete t[e];return t}function o(e,t){if(e.length>t){const i=/[\W]+$/g,r=e.substring(0,t),n=r.replace(i,"");return`${n.length?n:r.substring(0,t-1)}…`}return e}function s(){return window.TradingView.onChartPage}i.d(t,{cutString:()=>o,getChartSymbolPageUrl:()=>r,isOnChartPage:()=>s,omitUndefinedValues:()=>n})},666054:(e,t,i)=>{"use strict";var r;i.d(t,{ConnectionStatus:()=>r}),function(e){e[e.Closed=0]="Closed",e[e.Connecting=1]="Connecting",e[e.Open=2]="Open"}(r||(r={}))},30328:(e,t,i)=>{"use strict";function r(e){
Promise.all([i.e(56316),i.e(73018),i.e(51613),i.e(71931),i.e(30612),i.e(96996),i.e(66402),i.e(10584),i.e(27881),i.e(68398),i.e(6436),i.e(45182),i.e(93986),i.e(82757),i.e(8749),i.e(31758),i.e(61032),i.e(2118),i.e(21724),i.e(74194),i.e(8262),i.e(2481),i.e(82321),i.e(62526),i.e(72780),i.e(96756),i.e(9374)]).then(i.bind(i,126313)).then((({SymbolInfoDialogImpl:t})=>{t.getInstance().show(e)}))}i.d(t,{showSymbolInfoDialog:()=>r})},936913:(e,t,i)=>{"use strict";i.d(t,{shouldUseVerticalEditor:()=>n});var r=i(125226);i(62802);function n(){return(0,r.isFeatureEnabled)("vertical_editor")}},674488:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" fill-rule="evenodd" d="M15 9A6 6 0 1 1 3 9a6 6 0 0 1 12 0Zm1 0A7 7 0 1 1 2 9a7 7 0 0 1 14 0ZM7.97 5.87l-.78-.52V12.65l.78-.52 4.02-2.72.62-.41-.62-.42-4.02-2.7Zm.22 4.9V7.23L10.82 9l-2.63 1.77Z"/></svg>'},30556:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18 18" width="18" height="18"><path fill="currentColor" d="M7.5 4a.5.5 0 0 0-.5.5V5h4v-.5a.5.5 0 0 0-.5-.5h-3ZM12 5h3v1h-1.05l-.85 7.67A1.5 1.5 0 0 1 11.6 15H6.4a1.5 1.5 0 0 1-1.5-1.33L4.05 6H3V5h3v-.5C6 3.67 6.67 3 7.5 3h3c.83 0 1.5.67 1.5 1.5V5ZM5.06 6l.84 7.56a.5.5 0 0 0 .5.44h5.2a.5.5 0 0 0 .5-.44L12.94 6H5.06Z"/></svg>'}}]);